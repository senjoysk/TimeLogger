# 開発チェックリスト

## 🚀 新機能開発時のチェックリスト

### 1. 機能設計フェーズ
- [ ] **要件定義**: 機能の目的と仕様を明確化
- [ ] **インターフェース設計**: 依存関係とAPIを先に定義
- [ ] **テスト戦略**: 単体・統合・E2Eテストの計画作成
- [ ] **エラーケース**: 異常系シナリオの洗い出し

### 2. 実装フェーズ

#### 2.1 コーディング
- [ ] **Interface First**: 実装前にインターフェースを定義
- [ ] **Single Responsibility**: 各クラス・関数は単一責任
- [ ] **Error Handling**: `withErrorHandling`とAppErrorを使用
- [ ] **日本語コメント**: 全てのpublic関数にコメント

#### 2.2 新しいコマンド追加時
- [ ] **ハンドラー作成**: `ICommandHandler`を実装したクラス作成
- [ ] **CommandManager登録**: `bot.ts`の`initializeCommandManager()`に登録追加
- [ ] **自然言語対応**: キーワード検索での動作も考慮
- [ ] **ヘルプメッセージ**: 不明なコマンド時の説明に追加

#### 2.3 新しいサービス追加時
- [ ] **インターフェース定義**: 抽象化レイヤーを先に作成
- [ ] **Repository経由**: データアクセスは必ずRepository Pattern使用
- [ ] **依存関係注入**: コンストラクタでインターフェースを受け取る
- [ ] **モック可能**: テスト時に簡単にモック化できる設計

### 3. テストフェーズ

#### 3.1 必須テスト
- [ ] **単体テスト**: 新機能のクラス・関数のテスト
- [ ] **統合テスト**: 他コンポーネントとの結合テスト
- [ ] **E2Eテスト**: ユーザーシナリオでの動作テスト
- [ ] **エラーケーステスト**: 異常系の動作確認

#### 3.2 コマンド追加時の追加テスト
- [ ] **CommandManager統合テスト**: コマンド登録と動作確認
- [ ] **クリティカルコマンドテスト**: 重要コマンドの回帰テスト
- [ ] **自然言語処理テスト**: キーワード検索の動作確認
- [ ] **ヘルプメッセージテスト**: 不明なコマンド時の応答確認

#### 3.3 テスト実行
- [ ] **全テスト実行**: `npm test` で全テストパス
- [ ] **ビルド確認**: `npm run build` でエラーなし
- [ ] **カバレッジ確認**: `npm run test:coverage` で適切なカバレッジ
- [ ] **手動テスト**: 実際のDiscord環境での動作確認

### 4. デプロイメントフェーズ
- [ ] **ドキュメント更新**: README.mdの機能説明追加
- [ ] **コミットメッセージ**: 変更内容を明確に記述
- [ ] **ブランチ戦略**: 適切なブランチでの開発
- [ ] **レビュー**: プルリクエストでのコードレビュー

---

## 🔄 リファクタリング時のチェックリスト

### 1. 事前準備
- [ ] **現在のテスト実行**: 既存テストが全てパスすることを確認
- [ ] **テスト強化**: 足りないテストケースを追加
- [ ] **重要機能の特定**: クリティカルパスの洗い出し
- [ ] **ベースラインの設定**: 現在の動作を記録

### 2. リファクタリング実行
- [ ] **段階的変更**: 小さな単位での変更
- [ ] **テスト実行**: 各段階でテストを実行
- [ ] **動作確認**: 重要機能の手動テスト
- [ ] **コミット**: 動作する状態で細かくコミット

### 3. 完了確認
- [ ] **全テスト実行**: リファクタリング後にテスト全パス
- [ ] **E2Eテスト**: ユーザーシナリオでの動作確認
- [ ] **パフォーマンス**: 性能劣化がないことを確認
- [ ] **ドキュメント更新**: アーキテクチャ変更の文書化

---

## 🚨 クリティカルコマンド保護チェックリスト

### 重要コマンドの動作確認（必須）
毎回の変更後に以下のコマンドが正常動作することを確認:

- [ ] **`!timezone`** - 現在のタイムゾーン表示
- [ ] **`!timezone set Asia/Tokyo`** - タイムゾーン設定
- [ ] **`!timezone search Tokyo`** - タイムゾーン検索
- [ ] **`!summary`** - 今日のサマリー表示
- [ ] **`!summary 2025-06-27`** - 指定日サマリー表示
- [ ] **`!cost`** - API費用レポート表示

### 自然言語コマンドの確認
- [ ] **"サマリー"** - サマリー表示
- [ ] **"まとめ"** - サマリー表示
- [ ] **"費用"** - コストレポート表示
- [ ] **"コスト"** - コストレポート表示

### 活動記録の確認
- [ ] **通常メッセージ** - 活動記録として処理される
- [ ] **過去形メッセージ** - 適切に時間設定される
- [ ] **現在進行形** - 継続中活動として処理される

---

## 🔍 コードレビューチェックリスト

### アーキテクチャ遵守
- [ ] **依存関係注入**: インターフェースを使用しているか
- [ ] **単一責任**: クラス・関数が適切に責任分離されているか
- [ ] **Repository Pattern**: データアクセスが適切に抽象化されているか
- [ ] **Error Handling**: 統一されたエラー処理を使用しているか

### コード品質
- [ ] **命名**: 分かりやすい変数・関数名
- [ ] **コメント**: 日本語で適切にコメントされているか
- [ ] **型安全**: TypeScriptの型を適切に使用しているか
- [ ] **重複コード**: DRY原則が守られているか

### テストカバレッジ
- [ ] **新機能のテスト**: 追加機能のテストが存在するか
- [ ] **エラーケーステスト**: 異常系のテストが十分か
- [ ] **統合テスト**: コンポーネント間の結合テストがあるか
- [ ] **モック使用**: 適切にモックを使用しているか

---

## 🎯 定期メンテナンスチェックリスト

### 月次確認
- [ ] **依存関係更新**: npm auditとセキュリティチェック
- [ ] **テスト実行**: 全テストスイートの実行
- [ ] **パフォーマンス**: レスポンス時間の確認
- [ ] **ログ確認**: エラーログの分析

### 四半期確認
- [ ] **アーキテクチャレビュー**: 設計の見直し
- [ ] **技術負債**: リファクタリング候補の洗い出し
- [ ] **ドキュメント更新**: 最新状態への更新
- [ ] **セキュリティ監査**: 脆弱性チェック

---

## 📋 緊急時対応チェックリスト

### 障害発生時
- [ ] **影響範囲特定**: どの機能が影響を受けているか
- [ ] **ログ確認**: エラーログの分析
- [ ] **ロールバック判断**: 前バージョンに戻すべきか
- [ ] **ホットフィックス**: 最小限の修正で復旧

### 修正後確認
- [ ] **クリティカル機能**: 重要コマンドの動作確認
- [ ] **E2Eテスト**: ユーザーシナリオの実行
- [ ] **モニタリング**: 復旧後の監視
- [ ] **事後分析**: 原因分析と再発防止策

---

## ✅ このチェックリストの使い方

1. **プルリクエスト作成時**: 該当する項目をすべてチェック
2. **コードレビュー時**: レビュアーが各項目を確認
3. **リリース前**: 全項目の最終確認
4. **緊急時**: 緊急時対応チェックリストに従って対応

**🚨 重要**: クリティカルコマンドの動作確認は、どんな小さな変更でも必ず実行すること！