# 要件定義: AIタイムロガーBot

## 1. 概要 (Overview)

本プロジェクトは、DiscordをインターフェースとするAI Botを開発する。ユーザーは自然言語での対話を通じて、自身の活動を手軽に記録できる。Botはユーザーの発言を解釈し、適切な時間軸に活動内容を整理・記録し、日々の生産性向上を支援する。

## 2. 機能要件 (Functional Requirements)

### 2.1 自然言語による活動記録

ユーザーからの自由な形式のテキストメッセージをAIが解釈し、活動を記録する。

-   **入力**: DiscordのDMでの自由なテキストメッセージ。
-   **AIによる解釈**:
    -   **時間情報の抽出**: ユーザーの発言に含まれる時間表現（例: 「今」「さっき」「15分前」「14時から15時まで」）をAIが認識し、具体的な日時にマッピングする。
    -   **活動内容の抽出**: ユーザーが「何をしたか」をテキストから抽出する。
    -   **時間指定がない場合**: 発言に時間情報が含まれない場合は、メッセージの投稿時刻を活動の開始時刻とみなす。
-   **記録の単位**: 活動は30分単位のタイムスロットに記録・集計される。
-   **記録の柔軟性**:
    -   **リアルタイム記録**: 「今から〇〇する」「〇〇始めます」といった発言を、現在のタイムスロットの活動として記録する。
    -   **事後記録**: 「さっきは〇〇してた」「1時間前は△△」といった過去の活動に関する発言を、AIが適切な過去のタイムスロットに遡って記録する。
    -   **範囲指定記録**: 「14:00-15:30は会議」のように時間範囲を指定した場合、関連する全てのタイムスロットに活動を記録する。
-   **対話例**:
    -   `User: "今から設計作業に入ります"` -> 現在のタイムスロットに「設計作業」を記録。
    -   `User: "30分ほどメール対応してました"` -> 30分前のタイムスロットに「メール対応」を記録。
    -   `User: "14時から15時までA社と打ち合わせ"` -> 14:00, 14:30のタイムスロットに「A社と打ち合わせ」を記録。
    -   `User: "資料作成"` -> 現在のタイムスロットに「資料作成」を記録。

### 2.2 定期的な活動記録の促進 (リマインダー)

-   **目的**: ユーザーに活動記録を促し、記録漏れを防ぐ。
-   **実行タイミング**: 平日の9:00から18:00まで、毎時0分と30分。
-   **実行内容**: ユーザーへのDMで「この30分間なにしてた？」といった形式で問いかける。

### 2.3 日次サマリー

一日の活動を振り返るためのサマリーを生成する。

-   **生成タイミング**:
    -   **定時生成**: 毎日18:00にその日の活動サマリーを自動でDMに送信する。
    -   **オンデマンド生成**: ユーザーが「今日のサマリーちょうだい」といった趣旨のメッセージを送ることで、いつでもサマリーを生成できる。
-   **サマリー内容**:
    -   **活動カテゴリ別の時間集計**: AIが活動内容を動的にカテゴリ分類（例: 会議、開発、休憩）し、その集計時間を表示する。
    -   **AIによる所感**: その日の活動内容全体を基に、AIが労いの言葉や簡単な感想を生成する。
    -   **AIによるポジティブな一言**: 明日に向けた前向きなメッセージをAIが生成する。
-   **一日の区切り**: 1日の区切りは午前5:00から翌日の午前4:59までとする。

### 2.4 データ管理

-   **データ永続化**: 記録された活動データは永続的に保存される。（旧要件：当日のみから変更）
-   **データアクセス**: データはユーザーごとに完全に分離され、本人のみがアクセス可能。

## 3. 非機能要件 (Non-functional Requirements)

-   **可用性**: Botは24時間365日稼働していること。
-   **応答性能**: ユーザーからのメッセージに対して、Botは迅速に応答を返すこと。
-   **プライバシー**: ユーザーの活動記録は機密情報として扱い、本人以外は閲覧できないことを保証する。

## 4. 将来的な拡張要件 (Future Enhancements)

-   **高度なデータ操作**: 記録した活動の編集・削除機能。
-   **高度な時間表現の解釈**: 「昨日の午後」「今週の月曜日」といった、より曖昧な時間表現の解釈。
-   **集計期間の拡張**: 週次・月次でのサマリー機能。
-   **可視化**: 活動記録をグラフなどで可視化する機能。
-   **外部連携**: Google Calendarなど、外部サービスとの連携機能。
-   **マルチユーザー対応**: 複数人での利用やチームでの利用。

## 5. 技術スタック (Technology Stack)

-   **言語**: Node.js + TypeScript
-   **Discord連携**: discord.js
-   **AI/LLM**: Google Gemini API
-   **データベース**: SQLite (初期)
-   **スケジューラー**: node-cron