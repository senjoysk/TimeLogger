# Repository Guidelines

## Project Structure & Module Organization
- Source: `src/` (bots, services, repositories, web-admin, tests in `src/__tests__`)
- Build output: `dist/` (generated by TypeScript compiler)
- Scripts & tooling: `scripts/` (quality checks, staging/prod deploy)
- Config: `tsconfig.json`, `jest.config.js`, `.eslintrc.js`, `.env.*`
- Docs & assets: `docs/`, `src/web-admin/{views,public}`

## Build, Test, and Development Commands
- `npm run dev`: Run bot in development via `ts-node`.
- `npm run watch`: Dev mode with file watch/restart.
- `npm run build`: Compile TypeScript and copy assets to `dist/`.
- `npm start` / `npm run start:prod`: Run compiled app (prod env via `start:prod`).
- `npm test`: Run Jest tests; `test:coverage`, `test:integration`, `test:e2e` available.
- `npm run lint` / `lint:fix`: Lint TypeScript sources.
- `npm run quality:check`: Build, lint, and run key test suites.
- `npm run quality:gate`: Coverage + DI/SRP/file-size checks before merging.

## Coding Style & Naming Conventions
- Language: TypeScript (ES2022, strict mode). Indentation: 2 spaces.
- Linting: ESLint with `@typescript-eslint` (no unused vars, prefer explicit returns, limit function/file size, complexity guards).
- Patterns: Constructor DI with interfaces; avoid `any`. Prefer `PascalCase` for classes/types, `camelCase` for variables/functions. Interfaces commonly use `I` prefix (e.g., `IActivityLogRepository`).
- File names: follow existing `camelCase` (e.g., `enhancedScheduler.ts`) and module grouping under `src/{services,handlers,repositories,utils}`.

## Testing Guidelines
- Framework: Jest + ts-jest. Test roots in `src/`.
- Naming: place under `src/__tests__/` or use `*.test.ts` / `*.spec.ts`.
- Run: `npm test` (CI-friendly), `test:sequential` for flakiness, `test:cleanup` to remove WAL files.
- Coverage: maintain or improve current coverage (â‰ˆ65%+). Use `npm run test:coverage` and `npm run quality:coverage` in local checks.

## Commit & Pull Request Guidelines
- Commits: Conventional Commits (`feat:`, `fix:`, `refactor:`, `test:`) as in repo history.
- Before PR: run `npm run quality:gate` and ensure `npm run build` passes; add/adjust tests and update docs when behavior changes.
- PR content: clear description, linked issues (e.g., `Fixes #123`), relevant logs or screenshots for web-admin changes, and rollout notes if touching deploy scripts.

## Security & Configuration Tips
- Secrets: never commit real tokens. Use `.env.*.example` and local `.env.*` files.
- Environment: Node 20+ (`.nvmrc`). Admin credentials via `ADMIN_USERNAME/ADMIN_PASSWORD`.
- Database: use unified path (e.g., `app.db`); validate with `npm run check:database-paths`.
