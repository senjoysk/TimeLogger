# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸš¨ é‡è¦: ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

**Claude Codeã¯å¿…ãšä»¥ä¸‹ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„**

### Stagingç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆå¿…é ˆæ‰‹é †ï¼‰
```bash
# âœ… å¿…é ˆä½¿ç”¨: ãƒã‚·ãƒ³è‡ªå‹•å¾©æ—§æ©Ÿèƒ½ä»˜ãã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ¨å¥¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5åˆ†ï¼‰
npm run staging:deploy

# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
./scripts/staging/deploy-to-staging.sh

# âŒ ä½¿ç”¨ç¦æ­¢: ç›´æ¥ã®fly deployã‚³ãƒãƒ³ãƒ‰
# fly deploy --app timelogger-staging  # <- ã“ã‚Œã¯ä½¿ã‚ãªã„
```

**â±ï¸ Claude Codeå®Ÿè¡Œæ™‚ã®æ³¨æ„:**
- ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯é€šå¸¸3-5åˆ†ã‹ã‹ã‚Šã¾ã™
- Bashãƒ„ãƒ¼ãƒ«ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ300ç§’(5åˆ†)ã‚’æŒ‡å®šã—ã¦ãã ã•ã„
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸå ´åˆã¯æ‰‹å‹•ã§ `flyctl status --app timelogger-staging` ã§ç¢ºèª

### Productionç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆå¿…é ˆæ‰‹é †ï¼‰
```bash
# âœ… å¿…é ˆä½¿ç”¨: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ¨å¥¨ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: 5åˆ†ï¼‰
npm run prod:deploy

# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ  
./scripts/production/deploy.sh timelogger-bitter-resonance-9585

# âŒ ä½¿ç”¨ç¦æ­¢: ç›´æ¥ã®fly deployã‚³ãƒãƒ³ãƒ‰
# fly deploy --app timelogger-bitter-resonance-9585  # <- ã“ã‚Œã¯ä½¿ã‚ãªã„
```

**â±ï¸ Claude Codeå®Ÿè¡Œæ™‚ã®æ³¨æ„:**
- æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯é€šå¸¸3-5åˆ†ã‹ã‹ã‚Šã¾ã™
- Bashãƒ„ãƒ¼ãƒ«ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ300ç§’(5åˆ†)ã‚’æŒ‡å®šã—ã¦ãã ã•ã„
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ãŸå ´åˆã¯æ‰‹å‹•ã§ `flyctl status --app timelogger-bitter-resonance-9585` ã§ç¢ºèª

**ç†ç”±**: 
- Fly.ioã®ãƒã‚·ãƒ³ãŒåœæ­¢ã—ã¦ã„ã‚‹ã¨`fly deploy`ã¯å¤±æ•—ã™ã‚‹
- ä¸Šè¨˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯ãƒã‚·ãƒ³è‡ªå‹•å¾©æ—§æ©Ÿèƒ½ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹
- æ‰‹å‹•ã§ã®ãƒã‚·ãƒ³èµ·å‹•ä½œæ¥­ãŒä¸è¦ã«ãªã‚‹

## ğŸ”´ğŸŸ¢â™»ï¸ é–‹ç™ºæ–¹é‡: t_wadaå¼TDD

**ã™ã¹ã¦ã®é–‹ç™ºã¯ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ã®Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«ã§å®Ÿæ–½ã—ã¦ãã ã•ã„**

### TDDã®åŸºæœ¬ã‚µã‚¤ã‚¯ãƒ«
1. **ğŸ”´ Red**: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
2. **ğŸŸ¢ Green**: ãƒ†ã‚¹ãƒˆã‚’é€šã™æœ€å°é™ã®å®Ÿè£…
3. **â™»ï¸ Refactor**: ãƒ†ã‚¹ãƒˆãŒé€šã‚‹çŠ¶æ…‹ã‚’ä¿ã¡ãªãŒã‚‰ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

### t_wadaã•ã‚“ã®TDDåŸå‰‡
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: å®Ÿè£…å‰ã«å¿…ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ã
- **å°ã•ãªã‚¹ãƒ†ãƒƒãƒ—**: ä¸€åº¦ã«ä¸€ã¤ã®ã“ã¨ã ã‘
- **YAGNI (You Aren't Gonna Need It)**: å¿…è¦ã«ãªã‚‹ã¾ã§ä½œã‚‰ãªã„
- **ä¸‰è§’æ¸¬é‡**: è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‹ã‚‰ä¸€èˆ¬åŒ–ã‚’å°ã
- **æ˜ç™½ãªå®Ÿè£…**: ã‚·ãƒ³ãƒ—ãƒ«ã§åˆ†ã‹ã‚Šã‚„ã™ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã

## ğŸš¨ å¿…é ˆ: TDDé–‹ç™ºãƒ•ãƒ­ãƒ¼

### æ–°æ©Ÿèƒ½é–‹ç™ºã®æ‰‹é †
```bash
# 1. ğŸ”´ Red Phase - å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
npm run test:watch -- path/to/new.test.ts

# 2. ğŸŸ¢ Green Phase - ãƒ†ã‚¹ãƒˆã‚’é€šã™
# æœ€å°é™ã®å®Ÿè£…ï¼ˆä»®å®Ÿè£…ã§ã‚‚OKï¼‰

# 3. â™»ï¸ Refactor Phase - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
# ãƒ†ã‚¹ãƒˆãŒé€šã‚‹çŠ¶æ…‹ã‚’ç¶­æŒã—ãªãŒã‚‰æ”¹å–„

# 4. ç¹°ã‚Šè¿”ã—
# æ¬¡ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«é€²ã‚€
```

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‰ã®å¿…é ˆç¢ºèª
- [ ] TODOãƒªã‚¹ãƒˆã®ä½œæˆï¼ˆå®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ã‚’å°ã•ãªã‚¿ã‚¹ã‚¯ã«åˆ†è§£ï¼‰
- [ ] æœ€åˆã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ±ºå®šï¼ˆæœ€ã‚‚ç°¡å˜ãªã‚±ãƒ¼ã‚¹ã‹ã‚‰ï¼‰
- [ ] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®è¨­è¨ˆï¼ˆä½¿ã„æ–¹ã‹ã‚‰è€ƒãˆã‚‹ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®æ´—ã„å‡ºã—

## ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå¿…é ˆç†è§£ï¼‰
- **ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ **: ActivityLoggingIntegrationï¼ˆsrc/integration/activityLoggingIntegration.tsï¼‰
- **çµ±åˆãƒªãƒã‚¸ãƒˆãƒª**: SqliteActivityLogRepositoryï¼ˆæ´»å‹•ãƒ­ã‚° + APIã‚³ã‚¹ãƒˆç›£è¦–ï¼‰
- **ã‚³ãƒãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ **: ICommandHandlerå®Ÿè£…ã«ã‚ˆã‚‹å€‹åˆ¥ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: 65.6%ï¼ˆ__tests__/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰

## TDDã§ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### 1. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆé–‹ç™º
```typescript
// âŒ æ‚ªã„ä¾‹: å®Ÿè£…ã‚’å…ˆã«æ›¸ã
export class NewService {
  doSomething() { /* å®Ÿè£… */ }
}

// âœ… è‰¯ã„ä¾‹: ãƒ†ã‚¹ãƒˆã‹ã‚‰æ›¸ã
describe('NewService', () => {
  test('ä½•ã‹ã‚’ã™ã‚‹', () => {
    const service = new NewService();
    expect(service.doSomething()).toBe(expected);
  });
});
```

### 2. ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹é§†å‹•è¨­è¨ˆ
- **ä½¿ã„æ–¹ã‹ã‚‰è¨­è¨ˆ**: ãƒ†ã‚¹ãƒˆã§ç†æƒ³çš„ãªä½¿ã„æ–¹ã‚’å…ˆã«æ›¸ã
- **Interface First**: src/repositories/interfaces.ts, src/handlers/interfaces.ts ã‚’æ´»ç”¨
- **ä¾å­˜æ€§æ³¨å…¥**: ãƒ†ã‚¹ã‚¿ãƒ–ãƒ«ãªè¨­è¨ˆã®ãŸã‚ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æ³¨å…¥

### 3. å®Ÿè£…è¦ç´„
- **çµ±åˆãƒªãƒã‚¸ãƒˆãƒªä½¿ç”¨**: SqliteActivityLogRepositoryï¼ˆIActivityLogRepository + IApiCostRepositoryï¼‰ã‚’æ´»ç”¨
- **Error Handling**: withErrorHandling ã¨ AppError ã‚’å¿…ãšä½¿ç”¨
- **æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆ**: å…¨ã¦ã®publicé–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹ã«JSDocã‚³ãƒ¡ãƒ³ãƒˆï¼ˆæ—¥æœ¬èªï¼‰
- **å‹å®‰å…¨æ€§**: src/types/activityLog.ts ã®å‹å®šç¾©ã‚’æœ€å¤§é™æ´»ç”¨

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- **è¨€èª**: Node.js + TypeScript
- **Discord**: discord.js v14
- **AI**: Google Gemini gemini-2.0-flash
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: SQLite3
- **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Jest
- **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼**: node-cron

## ğŸŒ ç’°å¢ƒæˆ¦ç•¥ã¨ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

### 3å±¤ç’°å¢ƒæ§‹æˆ
```
Localç’°å¢ƒ â†’ Stagingç’°å¢ƒ â†’ Productionç’°å¢ƒ
  â†“           â†“            â†“
TDDé–‹ç™º    fly.ioæ¤œè¨¼    æœ¬ç•ªé‹ç”¨
```

#### **Localç’°å¢ƒ** (é–‹ç™ºè€…ç«¯æœ«)
- **ç”¨é€”**: TDDé–‹ç™ºã€å˜ä½“ãƒ†ã‚¹ãƒˆã€æ©Ÿèƒ½å®Ÿè£…
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: ãƒ­ãƒ¼ã‚«ãƒ«SQLite
- **å®Ÿè¡Œ**: `npm run dev`, `npm run test:watch`

#### **Stagingç’°å¢ƒ** (fly.io: timelogger-staging)
- **ç”¨é€”**: fly.ioç’°å¢ƒã§ã®çµ±åˆãƒ†ã‚¹ãƒˆã€æœ¬ç•ªå‰æ¤œè¨¼
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: åˆ†é›¢DB + ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
- **ãƒˆãƒªã‚¬ãƒ¼**: **æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤** (GitHub Actionsã¯å“è³ªãƒã‚§ãƒƒã‚¯ã®ã¿)

#### **Productionç’°å¢ƒ** (fly.io: timelogger-bitter-resonance-9585)
- **ç”¨é€”**: å®Ÿéš›ã®Discord Boté‹ç”¨
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: æœ¬ç•ªãƒ‡ãƒ¼ã‚¿
- **ãƒˆãƒªã‚¬ãƒ¼**: mainãƒ–ãƒ©ãƒ³ãƒpush â†’ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆstagingæ¤œè¨¼å®Œäº†å¾Œï¼‰

### ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼
```
feature/* â†’ develop â†’ å“è³ªãƒã‚§ãƒƒã‚¯ â†’ æ‰‹å‹•staging â†’ main â†’ production
```

#### å¿…é ˆãƒ—ãƒ­ã‚»ã‚¹
1. **Localé–‹ç™º**: TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº† + å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ
2. **develop ãƒãƒ¼ã‚¸**: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ + GitHub Actionså“è³ªãƒã‚§ãƒƒã‚¯
3. **staging ãƒ‡ãƒ—ãƒ­ã‚¤**: `./scripts/staging/deploy-to-staging.sh` ã§æ‰‹å‹•å®Ÿè¡Œ
4. **stagingæ¤œè¨¼**: é‡è¦æ©Ÿèƒ½å‹•ä½œç¢ºèª + å“è³ªã‚²ãƒ¼ãƒˆ
5. **main ãƒãƒ¼ã‚¸**: stagingæ¤œè¨¼å®Œäº†å¾Œã®ã¿
6. **production ãƒ‡ãƒ—ãƒ­ã‚¤**: è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ + ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### Discord Boté–‹ç™ºç’°å¢ƒ
1. `nvm use` ã§Node.jsä»®æƒ³ç’°å¢ƒã‚’ä½¿ç”¨ï¼ˆ.nvmrcãƒ•ã‚¡ã‚¤ãƒ«ã§Node.js 20ã‚’æŒ‡å®šï¼‰
2. `npm install` ã§ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆä»®æƒ³ç’°å¢ƒå†…ï¼‰
3. `.env.example` ã‚’å‚è€ƒã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
4. Discord Bot Token ã¨ Google Gemini API Key ã‚’è¨­å®š

### ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºç’°å¢ƒ
1. ä¸Šè¨˜Discord Botç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å®Œäº†
2. ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼š
```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ï¼ˆå€¤ã¯å€‹åˆ¥è¨­å®šï¼‰
ADMIN_USERNAME=your_admin_username
ADMIN_PASSWORD=your_admin_password
```
3. ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ï¼š
```bash
npm run admin:dev
# ã‚¢ã‚¯ã‚»ã‚¹: http://localhost:3001
```

### Stagingç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
1. `fly apps create timelogger-staging` ã§stagingç’°å¢ƒä½œæˆ
2. `.env.staging` ã§stagingç”¨ç’°å¢ƒå¤‰æ•°è¨­å®š
3. `npm run staging:setup` ã§åˆæœŸè¨­å®šå®Ÿè¡Œ

### ğŸš€ Stagingç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ‰‹å‹•å®Ÿè¡Œï¼‰

**ğŸ“‹ æ¨å¥¨ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•:**
```bash
# ğŸ¯ åŸºæœ¬ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰
./scripts/staging/deploy-to-staging.sh

# ğŸš€ æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
./scripts/staging/deploy-to-staging.sh --skip-tests --force
```

**ğŸ“ æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †:**
1. **é–‹ç™ºå®Œäº†**: developãƒ–ãƒ©ãƒ³ãƒã§ã®é–‹ç™ºã¨TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº†
2. **å“è³ªç¢ºèª**: GitHub Actionsã§Pushæ™‚ã®å“è³ªãƒã‚§ãƒƒã‚¯é€šé
3. **ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ**: ãƒ­ãƒ¼ã‚«ãƒ«ã§stagingç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤
4. **å‹•ä½œç¢ºèª**: Stagingç’°å¢ƒã§ã®Discord Botå‹•ä½œãƒ†ã‚¹ãƒˆ
5. **æœ¬ç•ªãƒãƒ¼ã‚¸**: mainãƒ–ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸ã§productionè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

**ğŸ”§ è‡ªå‹•å¾©æ—§æ©Ÿèƒ½:**
- **ãƒã‚·ãƒ³åœæ­¢æ¤œå‡º**: jqã‚’ä½¿ã£ãŸè©³ç´°çŠ¶æ…‹åˆ†æ
- **è‡ªå‹•ãƒã‚·ãƒ³èµ·å‹•**: åœæ­¢ä¸­ãƒã‚·ãƒ³ã®è‡ªå‹•èµ·å‹•
- **èµ·å‹•å®Œäº†å¾…æ©Ÿ**: ç¢ºå®Ÿãªèµ·å‹•ç¢ºèªå¾Œã«ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: ãƒ‡ãƒ—ãƒ­ã‚¤å‰å¾Œã®å‹•ä½œç¢ºèª

**ğŸ“Š å®Ÿè¡Œãƒ•ãƒ­ãƒ¼:**
1. **ç’°å¢ƒãƒã‚§ãƒƒã‚¯**: Fly CLIã€stagingç’°å¢ƒã‚¢ãƒ—ãƒªã®å­˜åœ¨ç¢ºèª
2. **ãƒã‚·ãƒ³çŠ¶æ…‹ç¢ºèª**: åœæ­¢ä¸­ãƒã‚·ãƒ³ã®è‡ªå‹•æ¤œå‡º
3. **è‡ªå‹•å¾©æ—§**: åœæ­¢ä¸­ãƒã‚·ãƒ³ã®è‡ªå‹•èµ·å‹•ï¼ˆ15ç§’å¾…æ©Ÿï¼‰
4. **å“è³ªãƒã‚§ãƒƒã‚¯**: TypeScriptãƒ“ãƒ«ãƒ‰ + ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆ`--skip-tests`ã§çœç•¥å¯èƒ½ï¼‰
5. **ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ**: fly-staging.tomlè¨­å®šã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤
6. **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: https://timelogger-staging.fly.dev/health ç¢ºèª
7. **å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ**: è©³ç´°ãªãƒ‡ãƒ—ãƒ­ã‚¤çµæœãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º

**âœ… è§£æ±ºã•ã‚ŒãŸå•é¡Œ:**
- âŒ å¾“æ¥: ãƒã‚·ãƒ³åœæ­¢ â†’ ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•— â†’ æ‰‹å‹•èµ·å‹• â†’ å†ãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… ç¾åœ¨: **å®Œå…¨è‡ªå‹•åŒ–** â†’ ãƒã‚·ãƒ³åœæ­¢ã‚’æ°—ã«ã›ãšãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½

**âš ï¸ æ³¨æ„äº‹é …:**
- GitHub Actions ã§ã¯ `--skip-tests --force` ã§å®Ÿè¡Œï¼ˆCIå´ã§ãƒ†ã‚¹ãƒˆæ¸ˆã¿ã®ãŸã‚ï¼‰
- ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œã§ã¯å“è³ªãƒã‚§ãƒƒã‚¯è¾¼ã¿ã®å®Œå…¨å®Ÿè¡Œã‚’æ¨å¥¨
- `jq` ã‚³ãƒãƒ³ãƒ‰ãŒå¿…è¦ï¼ˆmacOS: `brew install jq`ï¼‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ï¼ˆç¾åœ¨ã®å®Ÿè£…ï¼‰
```
src/
â”œâ”€â”€ index.ts                          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ config.ts                         # ç’°å¢ƒå¤‰æ•°ç®¡ç†
â”œâ”€â”€ bot.ts                            # Discord Bot ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹
â”œâ”€â”€ scheduler.ts                      # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ activityLoggingIntegration.ts # ğŸ“ ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã‚¯ãƒ©ã‚¹
â”‚   â”œâ”€â”€ index.ts                      # çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â””â”€â”€ systemMigrator.ts             # ã‚·ã‚¹ãƒ†ãƒ ç§»è¡Œãƒ„ãƒ¼ãƒ«
â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ interfaces.ts                 # ğŸ“ ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ sqliteActivityLogRepository.ts # ğŸ“ çµ±åˆãƒªãƒã‚¸ãƒˆãƒªï¼ˆæ´»å‹•ãƒ­ã‚°+APIã‚³ã‚¹ãƒˆï¼‰
â”‚   â””â”€â”€ activityLogRepository.ts      # æ´»å‹•ãƒ­ã‚°ãƒªãƒã‚¸ãƒˆãƒªï¼ˆå‚è€ƒå®Ÿè£…ï¼‰
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ interfaces.ts                 # ğŸ“ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”œâ”€â”€ costCommandHandler.ts         # !cost ã‚³ãƒãƒ³ãƒ‰
â”‚   â”œâ”€â”€ timezoneCommandHandler.ts     # !timezone ã‚³ãƒãƒ³ãƒ‰
â”‚   â”œâ”€â”€ summaryCommandHandler.ts      # !summary ã‚³ãƒãƒ³ãƒ‰
â”‚   â”œâ”€â”€ newEditCommandHandler.ts      # !edit ã‚³ãƒãƒ³ãƒ‰
â”‚   â””â”€â”€ logsCommandHandler.ts         # !logs ã‚³ãƒãƒ³ãƒ‰
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ geminiService.ts              # ğŸ“ Gemini AIåˆ†æã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ activityLogService.ts         # ğŸ“ æ´»å‹•ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ summaryService.ts             # ã‚µãƒãƒªãƒ¼ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ unifiedAnalysisService.ts     # çµ±åˆåˆ†æã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ analysisCacheService.ts       # åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ activityLog.ts                # ğŸ“ æ´»å‹•ãƒ­ã‚°å‹å®šç¾©
â”‚   â””â”€â”€ todo.ts                       # ğŸ“ TODOå‹å®šç¾©
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ errorHandler.ts               # ğŸ“ çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”‚   â”œâ”€â”€ timeUtils.ts                  # æ™‚é–“é–¢é€£ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ commandValidator.ts           # ã‚³ãƒãƒ³ãƒ‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ web-admin/                        # ğŸ“ ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ start.ts                      # ç®¡ç†ã‚¢ãƒ—ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ server.ts                     # Express ã‚µãƒ¼ãƒãƒ¼è¨­å®š
â”‚   â”œâ”€â”€ interfaces/                   # Webç®¡ç†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â””â”€â”€ adminInterfaces.ts        # ç®¡ç†æ©Ÿèƒ½å‹å®šç¾©
â”‚   â”œâ”€â”€ repositories/                 # Webç®¡ç†ãƒªãƒã‚¸ãƒˆãƒª
â”‚   â”‚   â””â”€â”€ adminRepository.ts        # ç®¡ç†æ©Ÿèƒ½ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
â”‚   â”œâ”€â”€ services/                     # Webç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ adminService.ts           # ç®¡ç†æ©Ÿèƒ½ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ securityService.ts        # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»èªè¨¼
â”‚   â”‚   â””â”€â”€ todoManagementService.ts  # Web TODOç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”œâ”€â”€ routes/                       # Express ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”‚   â”œâ”€â”€ index.ts                  # ãƒ«ãƒ¼ãƒˆçµ±åˆ
â”‚   â”‚   â”œâ”€â”€ dashboard.ts              # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ tables.ts                 # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†
â”‚   â”‚   â””â”€â”€ todos.ts                  # TODOç®¡ç†
â”‚   â”œâ”€â”€ views/                        # EJS ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ dashboard.ejs             # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”»é¢
â”‚   â”‚   â”œâ”€â”€ table-list.ejs            # ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§
â”‚   â”‚   â”œâ”€â”€ table-detail.ejs          # ãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°
â”‚   â”‚   â”œâ”€â”€ todo-dashboard.ejs        # TODOç®¡ç†ç”»é¢
â”‚   â”‚   â””â”€â”€ todo-form.ejs             # TODOä½œæˆãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
â”‚   â”œâ”€â”€ middleware/                   # Express ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â””â”€â”€ errorHandler.ts          # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”‚   â”œâ”€â”€ types/                        # Webç®¡ç†å‹å®šç¾©
â”‚   â”‚   â””â”€â”€ admin.ts                  # ç®¡ç†ç”»é¢å…±é€šå‹
â”‚   â””â”€â”€ public/                       # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚       â”œâ”€â”€ css/                      # ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ
â”‚       â””â”€â”€ js/                       # JavaScript
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ newSchema.sql                 # ğŸ“ ç¾åœ¨ã®DBã‚¹ã‚­ãƒ¼ãƒ
â”‚   â””â”€â”€ database.ts                   # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
â””â”€â”€ __tests__/                        # ğŸ“ ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆ65.35%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
    â”œâ”€â”€ integration/                  # çµ±åˆãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ repositories/                 # ãƒªãƒã‚¸ãƒˆãƒªãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ services/                     # ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆ
    â””â”€â”€ utils/                        # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
```

ğŸ“: é‡è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

## TDDé–‹ç™ºã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬çš„ãªTDDãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```bash
# 1. ãƒ†ã‚¹ãƒˆã‚’ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§é–‹å§‹
npm run test:watch

# 2. æ–°ã—ã„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
touch src/__tests__/[feature].test.ts

# 3. Red â†’ Green â†’ Refactor ã‚µã‚¤ã‚¯ãƒ«ã‚’ç¹°ã‚Šè¿”ã™

# 4. å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¢ºèª
npm test

# 5. ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèª
npm run test:coverage
```

### ãã®ä»–ã®é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

#### Discord Boté–¢é€£
- `npm run dev`: é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
- `npm run build`: TypeScriptã‚’ãƒ“ãƒ«ãƒ‰
- `npm start`: æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
- `npm run watch`: ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ã—ã¦è‡ªå‹•å†èµ·å‹•
- `npm run test:integration`: çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ

#### ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–¢é€£
- `npm run admin:dev`: ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãƒ¢ãƒ¼ãƒ‰èµ·å‹•
- `npm run admin:copy-views`: EJSãƒ“ãƒ¥ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’distã«ã‚³ãƒ”ãƒ¼
- `npm run admin:copy-static`: é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’distã«ã‚³ãƒ”ãƒ¼

### Stagingç’°å¢ƒã‚³ãƒãƒ³ãƒ‰
- `npm run staging:deploy`: **stagingç’°å¢ƒã¸ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆãƒã‚·ãƒ³è‡ªå‹•å¾©æ—§æ©Ÿèƒ½ä»˜ãï¼‰**
- `npm run staging:logs`: stagingç’°å¢ƒãƒ­ã‚°ç¢ºèª
- `npm run staging:status`: stagingç’°å¢ƒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- `npm run staging:test`: stagingç’°å¢ƒå‹•ä½œãƒ†ã‚¹ãƒˆ
- `npm run staging:smoke`: é‡è¦æ©Ÿèƒ½ç…™å¹•ãƒ†ã‚¹ãƒˆ

## ğŸ”§ TDDå®Ÿè·µæ™‚ã®å¿…é ˆç¢ºèª

### Red Phaseï¼ˆãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼‰
- [ ] å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ã®TODOãƒªã‚¹ãƒˆã‚’ä½œæˆ
- [ ] æœ€ã‚‚ç°¡å˜ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‹ã‚‰é–‹å§‹
- [ ] ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆRedï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé©åˆ‡ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### Green Phaseï¼ˆå®Ÿè£…ã™ã‚‹ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆã‚’é€šã™æœ€å°é™ã®å®Ÿè£…
- [ ] ä»®å®Ÿè£…ï¼ˆãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰ã§ã‚‚OK
- [ ] ã‚³ãƒ”ãƒšã§ã‚‚OKï¼ˆå¾Œã§DRYï¼‰
- [ ] ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆGreenï¼‰

### Refactor Phaseï¼ˆæ”¹å–„ã™ã‚‹ï¼‰
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
- [ ] é‡è¤‡ã‚³ãƒ¼ãƒ‰ã‚’é™¤å»
- [ ] ã‚ˆã‚Šè‰¯ã„è¨­è¨ˆã«æ”¹å–„
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–ï¼ˆå¿…è¦ãªå ´åˆï¼‰

### ã‚³ãƒŸãƒƒãƒˆå‰ã®æœ€çµ‚ç¢ºèª
```bash
# TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº†å¾Œã®ç¢ºèª
npm run build              # TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
npm test                   # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå¿…é ˆï¼‰
npm run test:integration   # çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå¿…é ˆè¿½åŠ ï¼‰
npm run test:coverage      # ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèªï¼ˆ45.5%ä»¥ä¸Šç¶­æŒï¼‰
```

## ğŸš¨ Claude Code: ã‚¿ã‚¹ã‚¯å®Œäº†å‰ã®å¿…é ˆç¢ºèª

**Claude Codeã¯ä¾é ¼ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’å®Œäº†ã—ãŸã¨åˆ¤æ–­ã™ã‚‹å‰ã«ã€ä»¥ä¸‹ã‚’å¿…ãšå®Ÿè¡Œã—ã¦ãã ã•ã„:**

### ã‚¿ã‚¹ã‚¯å®Œäº†å‰ã®å“è³ªã‚²ãƒ¼ãƒˆ
```bash
# ğŸš¨ æœ€é‡è¦: Claude Codeã¯ã‚¿ã‚¹ã‚¯å®Œäº†å‰ã«å¿…ãšã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨

# 1. ãƒ“ãƒ«ãƒ‰ç¢ºèª
npm run build

# 2. æ”¹è‰¯ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨å¤±æ•—åˆ†æï¼ˆæ¨å¥¨ï¼‰
./scripts/test-analysis.sh

# 3. ã¾ãŸã¯å¾“æ¥ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm test                   # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆå«ã‚€ï¼‰
npm run test:integration   # çµ±åˆãƒ†ã‚¹ãƒˆç¢ºèªï¼ˆè¿½åŠ ç¢ºèªï¼‰

# 4. å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸã‚’ç¢ºèªã—ã¦ã‹ã‚‰å®Œäº†å ±å‘Š
echo "âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ: ã‚¿ã‚¹ã‚¯å®Œäº†"
```

#### test-analysis.shã®å„ªä½æ€§
- **å¤±æ•—åˆ†æè‡ªå‹•åŒ–**: ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã«è©³ç´°ãªå¤±æ•—æƒ…å ±ã‚’è‡ªå‹•æŠ½å‡º
- **å¤±æ•—ã‚µãƒãƒªãƒ¼**: å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã¨å…·ä½“çš„ãªã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’æ•´ç†
- **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: `test-reports/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è©³ç´°ãƒ­ã‚°ã‚’ä¿å­˜
- **Pre-commitãƒ•ãƒƒã‚¯çµ±åˆ**: Huskyã«ã‚ˆã‚‹è‡ªå‹•å“è³ªãƒã‚§ãƒƒã‚¯ã§ä½¿ç”¨ä¸­

### å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°
- **ã‚¿ã‚¹ã‚¯å®Ÿè£…å®Œäº†å¾Œ**: ã‚³ãƒ¼ãƒ‰ã®å®Ÿè£…ã‚„ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ãŒå®Œäº†ã—ãŸæ™‚ç‚¹
- **å®Œäº†å ±å‘Šå‰**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œå®Œäº†ã—ã¾ã—ãŸã€ã¨å ±å‘Šã™ã‚‹å‰
- **ã‚³ãƒŸãƒƒãƒˆæ¨å¥¨å‰**: git commitã‚’æ¨å¥¨ã™ã‚‹å‰

### ç›®çš„
- **stagingç’°å¢ƒã§ã®çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’é˜²æ­¢**: é–‹ç™ºæ™‚ç‚¹ã§çµ±åˆãƒ†ã‚¹ãƒˆå•é¡Œã‚’æ¤œå‡º
- **å“è³ªä¿è¨¼**: å˜ä½“ãƒ†ã‚¹ãƒˆã ã‘ã§ãªãçµ±åˆãƒ†ã‚¹ãƒˆã§ã®å‹•ä½œç¢ºèª
- **é–‹ç™ºé€Ÿåº¦å‘ä¸Š**: å¾Œæˆ»ã‚Šä½œæ¥­ã®å‰Šæ¸›

**ğŸ“ ã“ã®æ‰‹é †ã«ã‚ˆã‚Šã€stagingç’°å¢ƒã§åˆã‚ã¦çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•—ãŒç™ºè¦šã™ã‚‹ã“ã¨ã‚’é˜²ã’ã¾ã™ã€‚**

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®å¿…é ˆç¢ºèª

#### develop â†’ staging ãƒ‡ãƒ—ãƒ­ã‚¤å‰
```bash
# Pre-commitãƒ•ãƒƒã‚¯ãŒè‡ªå‹•å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
git commit -m "å¤‰æ›´å†…å®¹"

# ã¾ãŸã¯æ‰‹å‹•å®Ÿè¡Œ
npm run build               # TypeScriptãƒ“ãƒ«ãƒ‰
./scripts/test-analysis.sh  # ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨å¤±æ•—åˆ†æ
./scripts/code-review/srp-violation-check.sh      # SRPé•åãƒã‚§ãƒƒã‚¯
./scripts/code-review/file-size-check.sh          # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç›£è¦–
./scripts/code-review/dependency-injection-check.sh # DIå“è³ªãƒã‚§ãƒƒã‚¯
npm run check:database-paths # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯

# âœ… å…¨ãƒã‚§ãƒƒã‚¯é€šéå¾Œã«developãƒ–ãƒ©ãƒ³ãƒpush
```

#### æ”¹è‰¯ã•ã‚ŒãŸPre-commitãƒ•ãƒƒã‚¯
- **å¤šå±¤å“è³ªãƒã‚§ãƒƒã‚¯**: ãƒ“ãƒ«ãƒ‰â†’ãƒ†ã‚¹ãƒˆâ†’ã‚³ãƒ¼ãƒ‰å“è³ªâ†’è¨­è¨ˆåŸå‰‡ã®åŒ…æ‹¬çš„æ¤œè¨¼
- **å¤±æ•—åˆ†æè‡ªå‹•åŒ–**: ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®è©³ç´°æƒ…å ±è‡ªå‹•æŠ½å‡º
- **SRPé•åæ¤œå‡º**: å˜ä¸€è²¬ä»»åŸå‰‡é•åã®è‡ªå‹•æ¤œå‡ºï¼ˆä¾‹å¤–è¨±å¯æ©Ÿèƒ½ä»˜ãï¼‰
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç›£è¦–**: å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã®æ—©æœŸç™ºè¦‹ã¨åˆ†å‰²æ¨å¥¨
- **ä¾å­˜æ€§æ³¨å…¥ãƒã‚§ãƒƒã‚¯**: anyå‹ä½¿ç”¨ã¨DIãƒ‘ã‚¿ãƒ¼ãƒ³ã®å“è³ªç¢ºèª

#### main â†’ production ãƒ‡ãƒ—ãƒ­ã‚¤å‰
```bash
# Stagingç’°å¢ƒã§ã®æ¤œè¨¼å®Œäº†ç¢ºèª
npm run staging:test       # stagingç’°å¢ƒå‹•ä½œç¢ºèª
npm run staging:smoke      # é‡è¦æ©Ÿèƒ½ç…™å¹•ãƒ†ã‚¹ãƒˆ
# âœ… stagingæ¤œè¨¼å®Œäº†å¾Œã«mainãƒ–ãƒ©ãƒ³ãƒãƒãƒ¼ã‚¸
```

## ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«æ©Ÿèƒ½ã®ä¿è­·

### é‡è¦æ©Ÿèƒ½ã®å›å¸°ãƒ†ã‚¹ãƒˆï¼ˆå¿…é ˆï¼‰
ã©ã‚“ãªå°ã•ãªå¤‰æ›´ã§ã‚‚ä»¥ä¸‹ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªï¼š
- ActivityLoggingIntegrationã®åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
- é‡è¦ã‚³ãƒãƒ³ãƒ‰ï¼ˆ!cost, !summary, !timezoneï¼‰ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- SqliteActivityLogRepositoryã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ãƒ†ã‚¹ãƒˆ

### æ‰‹å‹•å‹•ä½œç¢ºèªï¼ˆãƒªãƒªãƒ¼ã‚¹å‰ï¼‰

#### Stagingç’°å¢ƒã§ã®æ¤œè¨¼ï¼ˆå¿…é ˆï¼‰
stagingç’°å¢ƒã®Discord Botã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ç¢ºèªï¼š
- `!cost` - APIè²»ç”¨ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
- `!summary` - ä»Šæ—¥ã®ã‚µãƒãƒªãƒ¼è¡¨ç¤º
- `!timezone` - ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³è¡¨ç¤ºãƒ»è¨­å®š
- `!edit [ID]` - ãƒ­ã‚°ç·¨é›†æ©Ÿèƒ½
- `!logs` - ãƒ­ã‚°ä¸€è¦§è¡¨ç¤º

#### Productionç’°å¢ƒã§ã®æœ€çµ‚ç¢ºèªï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰
æœ¬ç•ªç’°å¢ƒã®Discord Botã§é‡è¦æ©Ÿèƒ½ã®ç–é€šç¢ºèªï¼š
- åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰å¿œç­”ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–ï¼ˆ30åˆ†é–“ï¼‰

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆï¼ˆ2024å¹´12æœˆæ›´æ–°ï¼‰
1. **ActivityLoggingIntegration**: ãƒ¡ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã‚¯ãƒ©ã‚¹
2. **PartialCompositeRepository**: çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒªãƒã‚¸ãƒˆãƒªï¼ˆå°‚ç”¨ãƒªãƒã‚¸ãƒˆãƒªã‚’çµ±åˆï¼‰
3. **å°‚ç”¨ãƒªãƒã‚¸ãƒˆãƒªç¾¤**: SqliteActivityLogRepository, SqliteActivityPromptRepositoryç­‰
4. **ICommandHandler**: ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã®æŠ½è±¡åŒ–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
5. **GeminiService**: AIåˆ†æã‚µãƒ¼ãƒ“ã‚¹ï¼ˆGoogle Gemini 2.0 Flashï¼‰
6. **Error Handling**: AppError ã¨ withErrorHandling ã«ã‚ˆã‚‹çµ±ä¸€ã‚¨ãƒ©ãƒ¼å‡¦ç†

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### çµ±åˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆæœ€é‡è¦ï¼‰
- **ActivityLoggingIntegration**: å…¨ä½“ã®åˆæœŸåŒ–ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- **PartialCompositeRepository**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã®çµ±åˆå®Ÿè£…ï¼ˆPhase 4å®Œäº†ï¼‰
- **å°‚ç”¨ãƒªãƒã‚¸ãƒˆãƒª**: å„æ©Ÿèƒ½å°‚ç”¨ã®è»½é‡å®Ÿè£…ï¼ˆå˜ä¸€è²¬ä»»åŸå‰‡éµå®ˆï¼‰

#### ã‚³ãƒãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ 
- **ICommandHandler**: ã‚³ãƒãƒ³ãƒ‰å‡¦ç†ã®çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **å„CommandHandler**: å€‹åˆ¥ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…ï¼ˆcost, summary, timezoneç­‰ï¼‰

#### AIåˆ†æã‚·ã‚¹ãƒ†ãƒ 
- **GeminiService**: Google Gemini APIã¨ã®çµ±åˆ
- **UnifiedAnalysisService**: çµ±åˆåˆ†æãƒ­ã‚¸ãƒƒã‚¯
- **AnalysisCacheService**: åˆ†æçµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥

---

## ğŸ“‹ å¿…é ˆ: é–‹ç™ºãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå‚ç…§

**ã™ã¹ã¦ã®é–‹ç™ºä½œæ¥­ã¯ DEVELOPMENT_CHECKLIST.md ã®TDDã‚µã‚¤ã‚¯ãƒ«ã«å¾“ã£ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„**

**stagingç’°å¢ƒæ§‹æˆã¨ãƒªãƒªãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼ã®è©³ç´°ã¯ note/staging-environment-design.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„**

### ğŸš¨ çµ¶å¯¾ã«å®ˆã‚‹ã¹ãTDDãƒ«ãƒ¼ãƒ«
1. **ãƒ†ã‚¹ãƒˆãªã—ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªã„**
2. **å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ç¢ºèªã—ã¦ã‹ã‚‰å®Ÿè£…**
3. **ä¸€åº¦ã«ä¸€ã¤ã®ã“ã¨ã ã‘**
4. **æ˜ç™½ãªå®Ÿè£…ã‚’å¿ƒãŒã‘ã‚‹**
5. **TODOãƒªã‚¹ãƒˆã§é€²æ—ç®¡ç†**

**ğŸš¨ CRITICAL: å®Ÿè£…å‰ã«å¿…ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ãã€Red-Green-Refactorã‚µã‚¤ã‚¯ãƒ«ã‚’å®ˆã‚‹ã“ã¨**

## ğŸš¨ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¿…é ˆãƒ•ãƒ­ãƒ¼ï¼ˆå†ç™ºé˜²æ­¢ç­–ï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚ã®å¿…é ˆæ‰‹é †
**Claude Code: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚ã¯ä»¥ä¸‹ã‚’å¿…ãšå®Ÿè¡Œã—ã¦ãã ã•ã„**

#### ğŸ”¥ é‡å¤§ãªå•é¡Œ: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¼ã‚Œã«ã‚ˆã‚‹ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼
**å†ç™ºé˜²æ­¢ã®ãŸã‚ã€ä»¥ä¸‹ã®æ‰‹é †ã¯å³æ ¼ã«éµå®ˆã™ã‚‹ã“ã¨**

#### 1. ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã®å½±éŸ¿ç¯„å›²ç¢ºèª
- [ ] æ–°è¦ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ â†’ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å¿…é ˆ
- [ ] æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®ã‚«ãƒ©ãƒ è¿½åŠ  â†’ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å¿…é ˆ  
- [ ] åˆ¶ç´„å¤‰æ›´ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ  â†’ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«å¿…é ˆ
- [ ] **âŒ ç¦æ­¢: newSchema.sqlã®ã¿ã®å¤‰æ›´**ï¼ˆæ—¢å­˜DBãŒå£Šã‚Œã‚‹ï¼‰

#### 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆï¼ˆå¿…é ˆï¼‰
```bash
# é€£ç•ªã‚’ç¢ºèªã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
ls src/database/migrations/
touch src/database/migrations/00X_feature_description.sql
```

#### 3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹ã®è¨˜è¿°
- **ALTER TABLEæ–‡ã«ã‚ˆã‚‹æ®µéšçš„å¤‰æ›´**
- **ã‚«ãƒ©ãƒ å­˜åœ¨ãƒã‚§ãƒƒã‚¯**ï¼ˆé‡è¤‡å®Ÿè¡Œå¯¾å¿œï¼‰
- **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½ãªå®‰å…¨ãªå¤‰æ›´**
- **CHECKåˆ¶ç´„ã®é©åˆ‡ãªè¨­å®š**

#### 4. ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼ï¼ˆå¿…é ˆï¼‰
```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
npm run build
npm test
npm run test:integration
# âš ï¸ ã“ã®æ®µéšã§ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°å³åº§ã«ä¿®æ­£
```

#### 5. çµ±åˆãƒ†ã‚¹ãƒˆç¢ºèªï¼ˆå¿…é ˆï¼‰
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§ã‚¹ã‚­ãƒ¼ãƒæ•´åˆæ€§ã‚’ç¢ºèª
npm test && npm run test:integration
# âš ï¸ "table activity_logs has no column named XXX"ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã‚‰
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸è¶³ã—ã¦ã„ã‚‹è¨¼æ‹ 
```

### âŒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—ã®å…¸å‹çš„ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ğŸš¨ Issue #006äº‹ä¾‹: ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼Replyæ©Ÿèƒ½
**ç™ºç”Ÿã—ãŸå•é¡Œ**:
- `newSchema.sql`ã«ã‚«ãƒ©ãƒ å®šç¾©ã‚’è¿½åŠ 
- **006_reminder_reply_columns.sqlã‚’ä½œæˆã—å¿˜ã‚Œ**
- æ—¢å­˜DBã«ã‚«ãƒ©ãƒ ãŒå­˜åœ¨ã›ãšSQLITE_ERRORãŒç™ºç”Ÿ

#### ã‚„ã£ã¦ã¯ã„ã‘ãªã„ä¾‹
1. **âŒ newSchema.sqlã®ã¿æ›´æ–°ã—ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¿˜ã‚Œ**
2. **âŒ ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã®ã¿å‹•ä½œç¢ºèªï¼ˆæ—¢å­˜DBã§ãƒ†ã‚¹ãƒˆã—ãªã„ï¼‰**
3. **âŒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç•ªå·ã®é‡è¤‡ãƒ»æ¬ ç•ª**
4. **âŒ ç ´å£Šçš„å¤‰æ›´ï¼ˆNOT NULLåˆ¶ç´„ã®å¾Œä»˜ã‘ãªã©ï¼‰**
5. **âŒ æ‰‹å‹•ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æ¥å¤‰æ›´ï¼‰**

#### âœ… æ­£ã—ã„æ‰‹é †
1. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ â†’ newSchema.sqlæ›´æ–°**
2. **æ—¢å­˜DBã§ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ â†’ æ–°è¦DBã§ã®ã‚¹ã‚­ãƒ¼ãƒãƒ†ã‚¹ãƒˆ**
3. **é€£ç•ªç¢ºèª â†’ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´è¨˜éŒ²**
4. **æ®µéšçš„å¤‰æ›´ï¼ˆDEFAULTå€¤è¨­å®š â†’ å¾Œã«NOT NULLåˆ¶ç´„ï¼‰**

### ğŸ†˜ ç·Šæ€¥æ™‚ã®ã‚¹ã‚­ãƒ¼ãƒä¿®å¾©æ‰‹é †

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¼ã‚Œç™ºè¦šæ™‚
```bash
# 1. å½±éŸ¿ç¯„å›²ç¢ºèª
sqlite3 data/app.db ".schema table_name"

# 2. ç·Šæ€¥ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
touch src/database/migrations/00X_emergency_fix.sql

# 3. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹ä½œæˆï¼ˆä¾‹ï¼‰
cat > src/database/migrations/006_reminder_reply_columns.sql << 'EOF'
ALTER TABLE activity_logs ADD COLUMN is_reminder_reply BOOLEAN DEFAULT FALSE;
ALTER TABLE activity_logs ADD COLUMN time_range_start TEXT;
ALTER TABLE activity_logs ADD COLUMN time_range_end TEXT;
ALTER TABLE activity_logs ADD COLUMN context_type TEXT DEFAULT 'NORMAL' 
    CHECK (context_type IN ('REMINDER_REPLY', 'POST_REMINDER', 'NORMAL'));
EOF

# 4. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†èµ·å‹•ï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è‡ªå‹•å®Ÿè¡Œï¼‰
npm run dev

# 5. å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§æ¤œè¨¼
npm test && npm run test:integration
```

### ğŸ”§ Claude Codeå®Ÿè£…æ™‚ã®å¼·åˆ¶ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã‚’å«ã‚€æ©Ÿèƒ½å®Ÿè£…æ™‚
**ä»¥ä¸‹ã‚’å…¨ã¦ãƒã‚§ãƒƒã‚¯ã—ãªã‘ã‚Œã°å®Ÿè£…å®Œäº†ã¨ã¯èªã‚ãªã„**

- [ ] **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸã‹ï¼Ÿ**
- [ ] **æ—¢å­˜DBã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ãŸã‹ï¼Ÿ**
- [ ] **newSchema.sqlã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®æ•´åˆæ€§ã‚’ç¢ºèªã—ãŸã‹ï¼Ÿ**
- [ ] **çµ±åˆãƒ†ã‚¹ãƒˆã§ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã„ã‹ï¼Ÿ**
- [ ] **stagingç’°å¢ƒã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ¤œè¨¼ã‚’è¡Œã†ã‹ï¼ˆäºˆå®šï¼‰ï¼Ÿ**

#### å®Ÿè£…å®Œäº†å‰ã®æœ€çµ‚ç¢ºèªã‚³ãƒãƒ³ãƒ‰
```bash
# ã“ã‚Œã‚‰ãŒå…¨ã¦æˆåŠŸã—ãªã‘ã‚Œã°å®Ÿè£…æœªå®Œäº†
npm run build              # TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
npm test                   # å˜ä½“ãƒ†ã‚¹ãƒˆ
npm run test:integration   # çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆã‚¹ã‚­ãƒ¼ãƒç¢ºèªï¼‰
```

**ğŸ“ ã“ã‚Œã‚‰ã®ãƒã‚§ãƒƒã‚¯ã‚’æ€ ã‚‹ã¨ã€æœ¬ç•ªç’°å¢ƒã§ã‚¹ã‚­ãƒ¼ãƒã‚¨ãƒ©ãƒ¼ï¼ˆSQLITE_ERRORï¼‰ãŒç™ºç”Ÿã—ã¾ã™**

### ğŸ¯ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸã®ç›®å®‰

#### æ­£å¸¸ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œãƒ­ã‚°
```
ğŸš€ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™...
ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ['001_...', '003_...', '004_...', '005_...', '006_reminder_reply_columns.sql']
ğŸ“‹ å®Ÿè¡Œæ¸ˆã¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ['001', '003', '004', '005']
ğŸ“‹ ä¿ç•™ä¸­ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ['006_reminder_reply_columns.sql']
ğŸ”§ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ 006 ã‚’å®Ÿè¡Œä¸­...
âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ 006 ãŒå®Œäº†ã—ã¾ã—ãŸ (XXXms)
âœ… å…¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸ
```

#### å¤±æ•—ã®å…†å€™
```
âŒ æ´»å‹•ãƒ­ã‚°ä¿å­˜ã‚¨ãƒ©ãƒ¼: [Error: SQLITE_ERROR: table activity_logs has no column named XXX]
```
â†’ ã“ã®å ´åˆã€å¿…è¦ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸è¶³ã—ã¦ã„ã‚‹

---

## ğŸ”„ TDDã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### TDDã‚µã‚¤ã‚¯ãƒ«ã«ãŠã‘ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†ã®é‡è¦æ€§

TDDã§ã¯ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¡ãƒ³ãƒˆãŒé–‹ç™ºã®é€²è¡ŒçŠ¶æ³ã‚’ç¤ºã™é‡è¦ãªæŒ‡æ¨™ã¨ãªã‚Šã¾ã™ã€‚é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†ã«ã‚ˆã‚Šã€é–‹ç™ºè€…ã¯å®Ÿè£…ã®çµŒç·¯ã‚’ç†è§£ã—ã€å°†æ¥ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®¹æ˜“ã«ã§ãã¾ã™ã€‚

### ãƒ•ã‚§ãƒ¼ã‚ºåˆ¥ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†æ‰‹é †

#### 1. **ğŸ”´ Red Phase - å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã**
```typescript
// ğŸ”´ Red Phase: æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ - å®Ÿè£…å‰ãªã®ã§å¤±æ•—ã™ã‚‹
describe('ğŸ”´ Red Phase: æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ', () => {
  test('æ©Ÿèƒ½AãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', async () => {
    // ã“ã®æ™‚ç‚¹ã§ã¯å®Ÿè£…ãŒãªã„ãŸã‚ã€ãƒ†ã‚¹ãƒˆã¯å¤±æ•—ã™ã‚‹
    const result = await newFeature.doSomething();
    expect(result).toBe('expected'); // âŒ å¤±æ•—ã™ã‚‹
  });
});
```

#### 2. **ğŸŸ¢ Green Phase - ãƒ†ã‚¹ãƒˆã‚’é€šã™æœ€å°é™ã®å®Ÿè£…**
```typescript
// ğŸŸ¢ Green Phase: æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ - æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
describe('ğŸŸ¢ Green Phase: æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ', () => {
  test('æ©Ÿèƒ½AãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', async () => {
    // æœ€å°é™ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
    const result = await newFeature.doSomething();
    expect(result).toBe('expected'); // âœ… æˆåŠŸã™ã‚‹
  });
});
```

#### 3. **â™»ï¸ Refactor Phase - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**
```typescript
// â™»ï¸ Refactor Phase: æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†
describe('â™»ï¸ Refactor Phase: æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ', () => {
  test('æ©Ÿèƒ½AãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', async () => {
    // ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã‚‚ãƒ†ã‚¹ãƒˆãŒé€šã‚‹
    const result = await newFeature.doSomething();
    expect(result).toBe('expected'); // âœ… æˆåŠŸï¼ˆã‚ˆã‚Šè‰¯ã„å®Ÿè£…ï¼‰
  });
});
```

### å®Ÿè£…å®Œäº†å¾Œã®ã‚³ãƒ¡ãƒ³ãƒˆæ•´ç†

#### **é–‹ç™ºå®Œäº†æ™‚ã®æœ€çµ‚ã‚³ãƒ¡ãƒ³ãƒˆå½¢å¼**
```typescript
// é–‹ç™ºå®Œäº†å¾Œã¯ã€ãƒ•ã‚§ãƒ¼ã‚ºè¡¨è¨˜ã‚’å‰Šé™¤ã—ã€æ©Ÿèƒ½èª¬æ˜ã«å¤‰æ›´
describe('æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ', () => {
  test('æ©Ÿèƒ½AãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', async () => {
    // æ©Ÿèƒ½ã®èª¬æ˜ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
    // æ–°æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯â—‹â—‹ã‚’å®Ÿè¡Œã§ãã‚‹
    const result = await newFeature.doSomething();
    expect(result).toBe('expected'); // âœ… æœŸå¾…é€šã‚Šã®å‹•ä½œ
  });
});
```

### ã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†ã®æ³¨æ„ç‚¹

#### **âŒ é¿ã‘ã‚‹ã¹ãã‚³ãƒ¡ãƒ³ãƒˆ**
```typescript
// âŒ æ‚ªã„ä¾‹: å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã«å¯¾ã—ã¦Green Phaseã‚³ãƒ¡ãƒ³ãƒˆ
describe('ğŸŸ¢ Green Phase: æ—¢å­˜æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ', () => {
  // å®Ÿéš›ã«ã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½
  test('æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹', () => {
    // æ—¢ã«å®Ÿè£…æ¸ˆã¿ãªã®ã«Green Phaseã‚³ãƒ¡ãƒ³ãƒˆã¯ä¸é©åˆ‡
  });
});
```

#### **âœ… æ­£ã—ã„ã‚³ãƒ¡ãƒ³ãƒˆ**
```typescript
// âœ… è‰¯ã„ä¾‹: å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã®é©åˆ‡ãªè¨˜è¿°
describe('æ—¢å­˜æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰', () => {
  test('æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', () => {
    // æ—¢å­˜æ©Ÿèƒ½ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆ
    // æ©Ÿèƒ½ã®ä»•æ§˜: â—‹â—‹ã®å ´åˆã«â–¡â–¡ã‚’è¿”ã™
  });
});
```

### TDDã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### **é–‹ç™ºæ™‚ã®å¿…é ˆç¢ºèª**
- [ ] **Red Phase**: ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€ğŸ”´ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ã‘ã‚‹
- [ ] **Green Phase**: ãƒ†ã‚¹ãƒˆãŒé€šã£ãŸã‚‰ğŸŸ¢ã‚³ãƒ¡ãƒ³ãƒˆã«æ›´æ–°
- [ ] **Refactor Phase**: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†å¾Œã«â™»ï¸ã‚³ãƒ¡ãƒ³ãƒˆã«æ›´æ–°
- [ ] **å®Ÿè£…å®Œäº†**: ãƒ•ã‚§ãƒ¼ã‚ºè¡¨è¨˜ã‚’å‰Šé™¤ã—ã€æ©Ÿèƒ½èª¬æ˜ã‚³ãƒ¡ãƒ³ãƒˆã«å¤‰æ›´

#### **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã®ç¢ºèª**
- [ ] **ã‚³ãƒ¡ãƒ³ãƒˆã®ä¸€è²«æ€§**: å®Ÿè£…çŠ¶æ³ã¨ã‚³ãƒ¡ãƒ³ãƒˆãŒä¸€è‡´ã—ã¦ã„ã‚‹ã‹
- [ ] **ãƒ•ã‚§ãƒ¼ã‚ºè¡¨è¨˜ã®é©åˆ‡æ€§**: é–‹ç™ºä¸­ã®ã¿ãƒ•ã‚§ãƒ¼ã‚ºè¡¨è¨˜ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹
- [ ] **æ©Ÿèƒ½èª¬æ˜ã®æ˜ç¢ºæ€§**: å®Ÿè£…å®Œäº†å¾Œã¯æ©Ÿèƒ½èª¬æ˜ãŒé©åˆ‡ã‹

### å®Ÿéš›ã®ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£

#### **Issue #31ã®äº‹ä¾‹ã‹ã‚‰å­¦ã¶**
```typescript
// âŒ å•é¡Œã®ã‚ã£ãŸã‚³ãƒ¡ãƒ³ãƒˆ
describe('ğŸŸ¢ Green Phase: ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œã®ãƒ†ã‚¹ãƒˆ', () => {
  // å®Ÿéš›ã«ã¯ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œã¯æ—¢ã«å®Ÿè£…æ¸ˆã¿ã ã£ãŸ
  // ã“ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯å®Ÿæ…‹ã¨åˆã‚ãªã„
});

// âœ… ä¿®æ­£å¾Œã®ã‚³ãƒ¡ãƒ³ãƒˆ
describe('ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰', () => {
  // å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆ
  // ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œã«ã‚ˆã‚Šã€è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒæ™‚åˆ©ç”¨å¯èƒ½
});
```

### TDDã‚µã‚¤ã‚¯ãƒ«å®Œäº†å¾Œã®ä½œæ¥­

#### **å®Ÿè£…å®Œäº†æ™‚ã®å¿…é ˆä½œæ¥­**
1. **ãƒ•ã‚§ãƒ¼ã‚ºè¡¨è¨˜å‰Šé™¤**: å…¨ã¦ã®ğŸ”´ğŸŸ¢â™»ï¸è¡¨è¨˜ã‚’å‰Šé™¤
2. **æ©Ÿèƒ½èª¬æ˜è¿½åŠ **: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®èª¬æ˜ã‚’è¿½åŠ 
3. **ã‚³ãƒ¡ãƒ³ãƒˆæ•´ç†**: ä¸è¦ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã€é‡è¦ãªã‚³ãƒ¡ãƒ³ãƒˆã‚’æ•´ç†
4. **ãƒ†ã‚¹ãƒˆã®æ„å›³æ˜ç¢ºåŒ–**: ãƒ†ã‚¹ãƒˆã®ç›®çš„ã¨æœŸå¾…å€¤ã‚’æ˜ç¢ºã«è¨˜è¿°

**ğŸ“ TDDã‚³ãƒ¡ãƒ³ãƒˆç®¡ç†ã¯ã€é–‹ç™ºã®é€²è¡ŒçŠ¶æ³ã‚’æ­£ç¢ºã«åæ˜ ã—ã€å°†æ¥ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®¹æ˜“ã«ã™ã‚‹é‡è¦ãªä½œæ¥­ã§ã™ã€‚**

## ğŸŒ ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã‚¬ã‚¤ãƒ‰

### Webç®¡ç†æ©Ÿèƒ½é–‹ç™ºã®åŸå‰‡

#### 1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆé–‹ç™º**
- **ç’°å¢ƒåˆ¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**: æœ¬ç•ªç’°å¢ƒã§ã¯èª­ã¿å–ã‚Šå°‚ç”¨ãƒ¢ãƒ¼ãƒ‰å¿…é ˆ
- **èªè¨¼å¿…é ˆ**: å…¨ã¦ã®ãƒ«ãƒ¼ãƒˆã§Basicèªè¨¼ã‚’å®Ÿè£…
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼**: X-Content-Type-Options, X-Frame-Optionsç­‰ã‚’è¨­å®š
- **å…¥åŠ›æ¤œè¨¼**: å…¨ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

#### 2. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–UIè¨­è¨ˆ**
- **Tailwind CSS**: çµ±ä¸€ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ä½¿ç”¨
- **ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œã‚’å„ªå…ˆ
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
- **ç’°å¢ƒè­˜åˆ¥**: é–‹ç™ºãƒ»æœ¬ç•ªç’°å¢ƒã®è¦–è¦šçš„åŒºåˆ¥

#### 3. **Express.js ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**
- **Routeråˆ†é›¢**: æ©Ÿèƒ½åˆ¥ã«ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’åˆ†å‰²
- **ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢æ´»ç”¨**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€èªè¨¼ã®çµ±ä¸€åŒ–
- **EJSãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **é™çš„ãƒ•ã‚¡ã‚¤ãƒ«**: åŠ¹ç‡çš„ãªé™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡

### Webç®¡ç†é–‹ç™ºTDDæ‰‹é †

#### Phase 1: UIè¨­è¨ˆã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
```bash
# 1. ğŸ”´ Red Phase: UIãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆ
npm run test:watch -- src/__tests__/web-admin/routes/

# 2. ğŸŸ¢ Green Phase: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å®Ÿè£…
# - Express Routerä½œæˆ
# - åŸºæœ¬çš„ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹å®Ÿè£…

# 3. â™»ï¸ Refactor Phase: UIæ”¹å–„
# - EJSãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
# - Tailwind CSSã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
```

#### Phase 2: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
```bash
# 1. ğŸ”´ Red Phase: ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆä½œæˆ
npm run test:watch -- src/__tests__/web-admin/services/

# 2. ğŸŸ¢ Green Phase: ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
# - ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚¸ãƒƒã‚¯
# - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†

# 3. â™»ï¸ Refactor Phase: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
```

#### Phase 3: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
```bash
# 1. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
# - èªè¨¼ãƒ†ã‚¹ãƒˆ
# - ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ

# 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
# - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ¸¬å®š
# - ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³åŠ¹ç‡åŒ–
```

### Webç®¡ç†ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

#### 1. **Express ãƒ«ãƒ¼ã‚¿ãƒ¼æ§‹é€ **
```typescript
// âœ… è‰¯ã„ä¾‹: æ©Ÿèƒ½åˆ¥ãƒ«ãƒ¼ã‚¿ãƒ¼åˆ†é›¢
export function createTodoRouter(databasePath: string): Router {
  const router = Router();
  
  // ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–
  initializeServices(databasePath);
  
  // ãƒ«ãƒ¼ãƒˆå®šç¾©
  router.get('/', handleTodoList);
  router.post('/', handleTodoCreate);
  
  return router;
}
```

#### 2. **EJSãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¦ç´„**
```html
<!-- âœ… è‰¯ã„ä¾‹: å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ« -->
<%- include('partials/header', { title: 'TODOç®¡ç†' }) %>
<%- include('partials/navigation', { currentPage: 'todos' }) %>

<!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<main class="max-w-7xl mx-auto py-6">
  <!-- ... -->
</main>

<%- include('partials/footer') %>
```

#### 3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…**
```typescript
// âœ… è‰¯ã„ä¾‹: ç’°å¢ƒåˆ¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
if (environment.isReadOnly) {
  return res.status(403).render('error', {
    title: 'ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦',
    message: 'Productionç’°å¢ƒã§ã¯ç·¨é›†æ“ä½œã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“'
  });
}
```

#### 4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```typescript
// âœ… è‰¯ã„ä¾‹: çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
try {
  const result = await todoService.createTodo(data);
  res.redirect('/todos');
} catch (error) {
  next(error); // ã‚¨ãƒ©ãƒ¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã«å§”è­²
}
```

### Webç®¡ç†ãƒ‡ãƒãƒƒã‚°æ‰‹é †

#### 1. **ãƒ­ã‚°ç¢ºèª**
```bash
# ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã®ç¢ºèª
npm run admin:dev

# ç‰¹å®šã®ãƒ«ãƒ¼ãƒˆã®ãƒ‡ãƒãƒƒã‚°
curl -u ${ADMIN_USERNAME}:${ADMIN_PASSWORD} http://localhost:3001/todos -v
```

#### 2. **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒãƒƒã‚°**
```bash
# EJSãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
npm run admin:copy-views

# ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«
# - Network ã‚¿ãƒ–ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆç¢ºèª
# - Console ã‚¿ãƒ–ã§JavaScriptã‚¨ãƒ©ãƒ¼ç¢ºèª
```

#### 3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª**
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…å®¹ç¢ºèª
sqlite3 data/app.db "SELECT * FROM todo_tasks LIMIT 5;"

# ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¹ã‚­ãƒ¼ãƒç¢ºèª
sqlite3 data/app.db ".schema todo_tasks"
```

### Webç®¡ç†ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 1. **UXè¨­è¨ˆ**
- **æ˜ç¢ºãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ç¾åœ¨ä½ç½®ã®æ˜ç¤º
- **ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°**: å±é™ºãªæ“ä½œã®äº‹å‰ç¢ºèª
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**: å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œå¯¾å¿œ

#### 2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡è¡¨ç¤º
- **é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: CSS/JSãƒ•ã‚¡ã‚¤ãƒ«ã®æœ€é©é…ä¿¡
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªæœ€é©åŒ–**: N+1å•é¡Œã®å›é¿

#### 3. **ä¿å®ˆæ€§**
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–**: å†åˆ©ç”¨å¯èƒ½ãªEJSãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«
- **è¨­å®šåˆ†é›¢**: ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹è¨­å®šç®¡ç†
- **ãƒ­ã‚°è¨˜éŒ²**: é‹ç”¨æ™‚ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ”¯æ´

**ğŸŒ ç®¡ç†Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»UXãƒ»ä¿å®ˆæ€§ã‚’é‡è¦–ã—ãŸå …ç‰¢ãªç®¡ç†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™**

## ğŸš¨ ã‚¨ãƒ©ãƒ¼å‡¦ç†è¦ç´„ï¼ˆå¿…é ˆéµå®ˆï¼‰

### çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼å‡¦ç†ã®å®Ÿè£…

#### 1. **AppErroræ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ä½¿ç”¨ï¼ˆå¿…é ˆï¼‰**
ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã¯`AppError`ã¾ãŸã¯ãã®æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

```typescript
// âŒ æ‚ªã„ä¾‹: æ¨™æº–Errorã®ä½¿ç”¨
throw new Error('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼');

// âœ… è‰¯ã„ä¾‹: AppErroræ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã®ä½¿ç”¨
import { DatabaseError } from '../errors';
throw new DatabaseError('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ', {
  operation: 'connect',
  userId: user.id
});
```

#### 2. **catchç¯€ã§ã®ãƒ«ãƒ¼ãƒ«ï¼ˆå³å®ˆï¼‰**

##### ãƒ«ãƒ¼ãƒ«1: ã‚¨ãƒ©ãƒ¼ã®ãƒ­ã‚°è¨˜éŒ²
```typescript
// âŒ æ‚ªã„ä¾‹: console.errorã®ä½¿ç”¨
catch (error) {
  console.error('ã‚¨ãƒ©ãƒ¼:', error);
}

// âœ… è‰¯ã„ä¾‹: ãƒ­ã‚¬ãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã®ä½¿ç”¨
import { logger } from '../utils/logger';
catch (error) {
  const appError = new DatabaseError('å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ', {
    operation: 'save',
    error
  }, error instanceof Error ? error : undefined);
  
  logger.error('DATABASE', 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã‚¨ãƒ©ãƒ¼', appError);
  throw appError; // å¿…ãšå†ã‚¹ãƒ­ãƒ¼
}
```

##### ãƒ«ãƒ¼ãƒ«2: ã‚¨ãƒ©ãƒ¼ã®æ¡ã‚Šã¤ã¶ã—ç¦æ­¢
```typescript
// âŒ æ‚ªã„ä¾‹: ã‚¨ãƒ©ãƒ¼ã‚’æ¡ã‚Šã¤ã¶ã™
catch (error) {
  console.log('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒç¶šè¡Œã—ã¾ã™');
  // ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–ã—ã¦å‡¦ç†ã‚’ç¶šè¡Œ
}

// âœ… è‰¯ã„ä¾‹: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‡¦ç†
catch (error) {
  const appError = new ApiError('APIå‘¼ã³å‡ºã—ã«å¤±æ•—', { error });
  logger.error('API', 'APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼', appError);
  
  // å¾©æ—§å¯èƒ½ãªå ´åˆã¯ãƒªãƒˆãƒ©ã‚¤
  if (isRetryable(error)) {
    return retry();
  }
  
  // å¾©æ—§ä¸å¯èƒ½ãªå ´åˆã¯å¿…ãšå†ã‚¹ãƒ­ãƒ¼
  throw appError;
}
```

##### ãƒ«ãƒ¼ãƒ«3: withErrorHandlingã®æ´»ç”¨
```typescript
// éåŒæœŸå‡¦ç†ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
import { withErrorHandling, ErrorType } from '../utils/errorHandler';

const result = await withErrorHandling(
  async () => {
    return await database.query(sql);
  },
  ErrorType.DATABASE,
  { operation: 'query', sql }
);
```

#### 3. **åˆ©ç”¨å¯èƒ½ãªã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹**

```typescript
import {
  DatabaseError,      // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£
  ApiError,          // å¤–éƒ¨APIé–¢é€£
  ValidationError,   // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  DiscordError,      // Discord APIé–¢é€£
  SystemError,       // ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼
  NotFoundError,     // ãƒªã‚½ãƒ¼ã‚¹ä¸åœ¨
  TimeoutError,      // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  AuthenticationError, // èªè¨¼ã‚¨ãƒ©ãƒ¼
  ConfigurationError, // è¨­å®šã‚¨ãƒ©ãƒ¼
  NotImplementedError // æœªå®Ÿè£…
} from '../errors';
```

#### 4. **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®ä½¿ã„åˆ†ã‘**

```typescript
import { logger } from '../utils/logger';

// ãƒ‡ãƒãƒƒã‚°æƒ…å ±
logger.debug('PROCESS', 'å‡¦ç†é–‹å§‹', { userId });

// ä¸€èˆ¬æƒ…å ±
logger.info('PROCESS', 'å‡¦ç†å®Œäº†', { count: 10 });

// è­¦å‘Š
logger.warn('API', 'ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«è¿‘ã¥ã„ã¦ã„ã¾ã™', { remaining: 5 });

// ã‚¨ãƒ©ãƒ¼
logger.error('DATABASE', 'ã‚¯ã‚¨ãƒªå®Ÿè¡Œå¤±æ•—', error, { sql });

// æˆåŠŸ
logger.success('SYNC', 'åŒæœŸå®Œäº†', { records: 100 });
```

### ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã™ã¹ã¦ã®ã‚¨ãƒ©ãƒ¼ã¯`AppError`æ´¾ç”Ÿã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨
- [ ] `console.error`ã®ä½¿ç”¨ç¦æ­¢ï¼ˆ`logger.error`ã‚’ä½¿ç”¨ï¼‰
- [ ] catchç¯€ã§ã‚¨ãƒ©ãƒ¼ã‚’æ¡ã‚Šã¤ã¶ã•ãªã„
- [ ] å¿…è¦ã«å¿œã˜ã¦ã‚¨ãƒ©ãƒ¼ã‚’å†ã‚¹ãƒ­ãƒ¼
- [ ] ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’é©åˆ‡ã«å«ã‚ã‚‹
- [ ] é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã‚’é¸æŠ
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åŒºåˆ¥

## ğŸš¨ ãƒ­ã‚°ä½¿ç”¨è¦ç´„ï¼ˆIssue #57å¯¾å¿œï¼‰

### console.log/console.error ã®ä½¿ç”¨ç¦æ­¢

ã™ã¹ã¦ã®ãƒ­ã‚°å‡ºåŠ›ã¯çµ±ä¸€ã•ã‚ŒãŸLoggerã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

```typescript
// âŒ æ‚ªã„ä¾‹: consoleç›´æ¥ä½¿ç”¨
console.log('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸');
console.error('ã‚¨ãƒ©ãƒ¼');

// âœ… è‰¯ã„ä¾‹: Loggerã‚µãƒ¼ãƒ“ã‚¹ä½¿ç”¨
import { logger } from '../utils/logger';
logger.info('COMPONENT', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸');
logger.error('COMPONENT', 'ã‚¨ãƒ©ãƒ¼', error);
```

### ãƒ­ã‚°ä½¿ç”¨ã®åŸºæœ¬ãƒ«ãƒ¼ãƒ«

1. **å¿…ãš**Loggerã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ä½¿ç”¨
2. **çµ¶å¯¾ã«**console.log/error/warn/infoã‚’ç›´æ¥ä½¿ã‚ãªã„
3. **å¸¸ã«**é©åˆ‡ãªãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ï¼ˆdebug/info/warn/error/successï¼‰ã‚’é¸æŠ
4. **å¿…ãš**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåï¼ˆoperationï¼‰ã‚’æŒ‡å®š
5. **æ¨å¥¨**æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ç¬¬3å¼•æ•°ã«æ¸¡ã™

è©³ç´°ã¯ `/docs/logging-guideline.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### Pre-commitãƒ•ãƒƒã‚¯ã§ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯

ã‚³ãƒŸãƒƒãƒˆæ™‚ã«è‡ªå‹•çš„ã«consoleä½¿ç”¨ãŒæ¤œå‡ºã•ã‚Œã€ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ï¼š
```bash
./scripts/code-review/console-usage-check.sh
```

## ğŸš¨ å‹å®‰å…¨æ€§è¦ç´„ï¼ˆIssue #60å¯¾å¿œï¼‰

### anyå‹ä½¿ç”¨ã®å®Œå…¨ç¦æ­¢

TypeScriptã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§ã¯ã€anyå‹ã®ä½¿ç”¨ã‚’åŸå‰‡ã¨ã—ã¦ç¦æ­¢ã—ã¾ã™ã€‚

```typescript
// âŒ æ‚ªã„ä¾‹: anyå‹ã®ä½¿ç”¨
const data: any = fetchData();
function process(input: any): any { ... }

// âœ… è‰¯ã„ä¾‹: å…·ä½“çš„ãªå‹å®šç¾©
interface UserData {
  id: string;
  name: string;
}
const data: UserData = fetchData();
function process(input: UserData): ProcessResult { ... }
```

### anyå‹ä½¿ç”¨ã®ä¾‹å¤–ãƒ«ãƒ¼ãƒ«

ã‚„ã‚€ã‚’å¾—ãšanyå‹ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€å¿…ãš`// ALLOW_ANY`ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ä¸ã—ã€ç†ç”±ã‚’æ˜è¨˜ã—ã¦ãã ã•ã„ã€‚

```typescript
// ALLOW_ANY: sqlite3ã®RunResultã®changesãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã‚
resolve((this as any).changes > 0);

// ALLOW_ANY: Discord.jsã®ButtonComponentã‚’ButtonBuilderã«å¤‰æ›ã™ã‚‹ãŸã‚
const button = ButtonBuilder.from(component as any).setDisabled(true);
```

### é–¢æ•°ã®å‹æ³¨é‡ˆå¿…é ˆ

ã™ã¹ã¦ã®é–¢æ•°ã«ã¯æˆ»ã‚Šå€¤ã®å‹ã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¦ãã ã•ã„ã€‚

```typescript
// âŒ æ‚ªã„ä¾‹: æˆ»ã‚Šå€¤å‹ãªã—
function calculate(a: number, b: number) {
  return a + b;
}

// âœ… è‰¯ã„ä¾‹: æˆ»ã‚Šå€¤å‹ã‚ã‚Š
function calculate(a: number, b: number): number {
  return a + b;
}

// âœ… è‰¯ã„ä¾‹: asyncé–¢æ•°
async function fetchData(id: string): Promise<UserData> {
  // ...
}
```

### å‹å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯ã®è‡ªå‹•åŒ–

Pre-commitãƒ•ãƒƒã‚¯ã§å‹å®‰å…¨æ€§ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¾ã™ï¼š
```bash
./scripts/code-review/type-safety-check.sh
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‚’æ¤œå‡ºã—ã¾ã™ï¼š
- anyå‹ã®ä½¿ç”¨ï¼ˆALLOW_ANYã‚³ãƒ¡ãƒ³ãƒˆãªã—ï¼‰
- æš—é»™çš„ãªanyå‹
- å‹æ³¨é‡ˆã®ãªã„é–¢æ•°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
- æˆ»ã‚Šå€¤å‹ã®ãªã„é–¢æ•°

### é–‹ç™ºæ™‚ã®æ¨å¥¨äº‹é …

1. **VSCodeè¨­å®š**: `"typescript.tsserver.experimental.enableProjectDiagnostics": true`
2. **å®šæœŸçš„ãªå‹ãƒã‚§ãƒƒã‚¯**: `npx tsc --noEmit`
3. **strictãƒ¢ãƒ¼ãƒ‰ç¶­æŒ**: tsconfig.jsonã®`"strict": true`ã‚’å¤‰æ›´ã—ãªã„

## ğŸ—ï¸ ãƒ¬ã‚¤ãƒ¤åˆ†é›¢è¦ç´„ï¼ˆIssue #61å¯¾å¿œï¼‰

### ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ã‚¤ãƒ³ãƒ•ãƒ©ãƒ­ã‚¸ãƒƒã‚¯ã®å®Œå…¨åˆ†é›¢

Issue #61å¯¾å¿œã¨ã—ã¦ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ˜ç¢ºãªåˆ†é›¢ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ¬ã‚¤ãƒ¤åˆ†é›¢ãƒ«ãƒ¼ãƒ«ã‚’**å³æ ¼ã«éµå®ˆ**ã—ã¦ãã ã•ã„ã€‚

### ãƒ¬ã‚¤ãƒ¤åˆ†é›¢ã®åŸºæœ¬åŸå‰‡

#### 1. **ã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ï¼‰ã®è²¬ä»»**
```typescript
// âœ… è‰¯ã„ä¾‹: ãƒªãƒã‚¸ãƒˆãƒªçµŒç”±ã®ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
export class ActivityAnalysisService {
  constructor(
    private repository: IActivityLogRepository,
    private apiClient: IGeminiApiClient
  ) {}
  
  async analyzeActivity(userId: string): Promise<AnalysisResult> {
    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­
    const logs = await this.repository.getLogsByDate(userId, date);
    const result = await this.apiClient.analyzeContent(logs);
    return this.processAnalysisResult(result);
  }
}
```

#### 2. **ç¦æ­¢äº‹é …: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹**
```typescript
// âŒ æ‚ªã„ä¾‹: ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§ã®DBç›´æ¥æ“ä½œ
export class BadService {
  async getData(): Promise<Data[]> {
    // ç¦æ­¢: SQLite3ç›´æ¥ä½¿ç”¨
    const db = new sqlite3.Database('./data.db');
    return new Promise((resolve) => {
      db.all('SELECT * FROM table', resolve);
    });
  }
  
  async fetchApiData(): Promise<ApiData> {
    // ç¦æ­¢: HTTPç›´æ¥å‘¼ã³å‡ºã—
    const response = await fetch('https://api.example.com/data');
    return response.json();
  }
  
  async getDiscordMessage(messageId: string): Promise<Message> {
    // ç¦æ­¢: Discord APIç›´æ¥æ“ä½œ
    return await message.channel.messages.fetch(messageId);
  }
}
```

### é©åˆ‡ãªãƒ¬ã‚¤ãƒ¤åˆ†é›¢ã®å®Ÿè£…

#### 1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹**: ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// âœ… ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰
export interface IActivityLogRepository {
  getLogsByDate(userId: string, date: string): Promise<ActivityLog[]>;
  saveLog(log: ActivityLog): Promise<void>;
}

// âœ… ã‚µãƒ¼ãƒ“ã‚¹å±¤å®Ÿè£…
export class ActivityLogService {
  constructor(private repository: IActivityLogRepository) {}
  
  async processActivity(userId: string, date: string): Promise<void> {
    const logs = await this.repository.getLogsByDate(userId, date);
    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å‡¦ç†...
  }
}
```

#### 2. **å¤–éƒ¨APIå‘¼ã³å‡ºã—**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// âœ… ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰
export interface IGeminiApiClient {
  analyzeContent(content: string): Promise<AnalysisResult>;
}

// âœ… ã‚µãƒ¼ãƒ“ã‚¹å±¤å®Ÿè£…
export class AnalysisService {
  constructor(private apiClient: IGeminiApiClient) {}
  
  async performAnalysis(content: string): Promise<ProcessedResult> {
    const result = await this.apiClient.analyzeContent(content);
    return this.processResult(result);
  }
}
```

#### 3. **Discord APIæ“ä½œ**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ©ãƒƒãƒ‘ãƒ¼
```typescript
// âœ… ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ï¼‰
export interface IDiscordMessageClient {
  fetchReferencedMessage(message: Message, messageId: string): Promise<Message | null>;
}

// âœ… ã‚µãƒ¼ãƒ“ã‚¹å±¤å®Ÿè£…
export class ReminderReplyService {
  constructor(private discordClient: IDiscordMessageClient) {}
  
  async isReminderReply(message: Message): Promise<ReminderReplyResult> {
    const referenced = await this.discordClient.fetchReferencedMessage(
      message, 
      message.reference?.messageId
    );
    // ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å‡¦ç†...
  }
}
```

### ä¾‹å¤–è¨±å¯ã®ä»•çµ„ã¿

ã‚„ã‚€ã‚’å¾—ãšç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ãªå ´åˆã¯ã€**ä¾‹å¤–ã‚³ãƒ¡ãƒ³ãƒˆ**ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„ï¼š

```typescript
// âœ… ä¾‹å¤–è¨±å¯ã®ä¾‹
export class ConfigService {
  loadConfig(): void {
    // ALLOW_LAYER_VIOLATION: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ã®ãŸã‚ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹
    this.config.set('discordToken', process.env.DISCORD_BOT_TOKEN);
  }
}
```

**åˆ©ç”¨å¯èƒ½ãªä¾‹å¤–ã‚³ãƒ¡ãƒ³ãƒˆ:**
- `// ALLOW_LAYER_VIOLATION:` - ä¸€èˆ¬çš„ãªãƒ¬ã‚¤ãƒ¤åˆ†é›¢é•åã®è¨±å¯
- `// ALLOW_DB_ACCESS:` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã®è¨±å¯  
- `// ALLOW_API_ACCESS:` - APIç›´æ¥å‘¼ã³å‡ºã—ã®è¨±å¯

### è‡ªå‹•ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½

Pre-commitãƒ•ãƒƒã‚¯ã§è‡ªå‹•çš„ã«ãƒ¬ã‚¤ãƒ¤åˆ†é›¢é•åã‚’æ¤œå‡ºã—ã¾ã™ï¼š

```bash
./scripts/code-review/layer-separation-check.sh
```

**æ¤œå‡ºå¯¾è±¡:**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç›´æ¥æ“ä½œï¼ˆsqlite3, Database, db.queryç­‰ï¼‰
- HTTP/APIç›´æ¥å‘¼ã³å‡ºã—ï¼ˆfetch, axios, gotç­‰ï¼‰
- Discord APIç›´æ¥æ“ä½œï¼ˆchannel.messages.fetchç­‰ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ç›´æ¥æ“ä½œï¼ˆfs.readFileç­‰ï¼‰

### ãƒ¬ã‚¤ãƒ¤åˆ†é›¢ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### é–‹ç™ºæ™‚ã®å¿…é ˆç¢ºèª
- [ ] ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§DBæ“ä½œã‚’è¡Œã†å ´åˆã€ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ã‹ï¼Ÿ
- [ ] ã‚µãƒ¼ãƒ“ã‚¹å±¤ã§APIå‘¼ã³å‡ºã—ã‚’è¡Œã†å ´åˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ã‹ï¼Ÿ
- [ ] ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ãªå ´åˆã€é©åˆ‡ãªä¾‹å¤–ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ãŸã‹ï¼Ÿ
- [ ] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤ã§å®šç¾©ã—ã€å®Ÿè£…ã¯ã‚¤ãƒ³ãƒ•ãƒ©å±¤ã«é…ç½®ã—ãŸã‹ï¼Ÿ

#### ã‚³ãƒŸãƒƒãƒˆå‰ã®å¿…é ˆãƒã‚§ãƒƒã‚¯
```bash
# ãƒ¬ã‚¤ãƒ¤åˆ†é›¢ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
./scripts/code-review/layer-separation-check.sh

# æœŸå¾…ã•ã‚Œã‚‹çµæœ
âœ… ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢ãƒã‚§ãƒƒã‚¯å®Œäº†: å•é¡Œãªã—
```

### æœŸå¾…ã™ã‚‹åŠ¹æœ

1. **ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã®å‘ä¸Š**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹çµŒç”±ã§ãƒ¢ãƒƒã‚¯å¯èƒ½
2. **å†åˆ©ç”¨æ€§ã®å‘ä¸Š**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ã‚¤ãƒ³ãƒ•ãƒ©ã®ç‹¬ç«‹æ€§
3. **ä¿å®ˆæ€§ã®å‘ä¸Š**: å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’æœ€å°åŒ–
4. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ˜ç¢ºåŒ–**: è²¬ä»»ã®æ‰€åœ¨ãŒæ˜ç¢º

**ğŸ“ ãƒ¬ã‚¤ãƒ¤åˆ†é›¢ã®å¾¹åº•ã«ã‚ˆã‚Šã€å …ç‰¢ã§ä¿å®ˆã—ã‚„ã™ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Ÿç¾ã—ã¾ã™ã€‚**