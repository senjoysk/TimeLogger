# コマンドリファレンス

Discord TimeLogger with TODO Management の全コマンド仕様書です。

## 📝 活動記録コマンド

### 基本的な活動記録

#### 自然言語入力（最も基本的な使用方法）
```
入力: 任意の自然言語メッセージ
処理: 自動で活動ログとして記録、AI分析、TODO検出
```

**例:**
```bash
"14:00-15:30は会議でした"
"いま30分休憩していた"
"午前中ずっとプログラミング"
"資料を作成する必要がある"  # TODO自動検出対象
```

**レスポンス:**
- 🎯 リアクション（記録成功）
- 💭 TODO検出時: 分類結果UI表示（ボタン付きEmbed）

---

## ✏️ 活動記録編集コマンド

### `!edit` - ログ一覧表示
```bash
!edit
```

**機能**: 今日の活動ログ一覧をID付きで表示

**レスポンス例:**
```
📝 今日の活動ログ一覧

1. [09:30] プロジェクト会議に参加
2. [11:00] 資料作成作業
3. [14:30] バグ修正

編集: !edit <ID> <新内容>
削除: !edit delete <ID>
```

### `!edit <ID> <新内容>` - ログ編集
```bash
!edit 2 資料作成とレビュー作業
```

**パラメータ:**
- `ID` (必須): ログのID番号
- `新内容` (必須): 更新する内容

**レスポンス:**
- ✅ 成功: "ログを更新しました"
- ❌ 失敗: "指定されたログが見つかりません"

### `!edit delete <ID>` - ログ削除
```bash
!edit delete 3
```

**パラメータ:**
- `ID` (必須): 削除するログのID番号

**レスポンス:**
- ✅ 成功: "ログを削除しました"
- ❌ 失敗: "指定されたログが見つかりません"

---

## 📋 ログ表示コマンド

### `!logs` - 生ログ一覧表示
```bash
!logs
```

**機能**: 今日の活動ログを時系列で表示

**レスポンス例:**
```
📋 今日の活動ログ

[09:30] プロジェクト会議に参加
[11:00] 資料作成作業  
[14:30] バグ修正
[16:00] テストコード作成

合計: 4件のログ
```

---

## ✅ TODO管理コマンド

### `!todo` - TODO一覧表示
```bash
!todo
```

**機能**: 現在のTODO一覧を表示

**レスポンス例:**
```
📋 TODO一覧

🔴 高優先度
• [todo-001] プレゼン資料を作成する (pending)

🟡 普通優先度  
• [todo-002] バグ修正 (in_progress)
• [todo-003] テストコード追加 (pending)

🟢 低優先度
• [todo-004] ドキュメント更新 (pending)

完了: 2件 | 進行中: 1件 | 未着手: 3件
```

### `!todo add <内容>` - TODO追加
```bash
!todo add プレゼン資料を作成する
```

**パラメータ:**
- `内容` (必須): TODOの内容

**レスポンス:**
- ✅ 成功: "TODO「プレゼン資料を作成する」を追加しました！"

### `!todo done <ID>` - TODO完了
```bash
!todo done todo-123
```

**パラメータ:**
- `ID` (必須): TODOのID

**レスポンス:**
- ✅ 成功: "🎉 TODO「[内容]」を完了しました！"
- ❌ 失敗: "指定されたTODOが見つかりません"

### `!todo start <ID>` - TODO開始
```bash
!todo start todo-123
```

**パラメータ:**
- `ID` (必須): TODOのID

**レスポンス:**
- ✅ 成功: "🚀 TODO「[内容]」を開始しました！"

### `!todo edit <ID> <新内容>` - TODO編集
```bash
!todo edit todo-123 資料作成（修正版）
```

**パラメータ:**
- `ID` (必須): TODOのID
- `新内容` (必須): 新しいTODO内容

**レスポンス:**
- ✅ 成功: "✏️ TODO「[元内容]」を「[新内容]」に編集しました！"

### `!todo delete <ID>` - TODO削除
```bash
!todo delete todo-123
```

**パラメータ:**
- `ID` (必須): TODOのID

**レスポンス:**
- ✅ 成功: "🗑️ TODO「[内容]」を削除しました。"

### `!todo search <キーワード>` - TODO検索
```bash
!todo search 資料
```

**パラメータ:**
- `キーワード` (必須): 検索キーワード

**レスポンス例:**
```
🔍 検索結果: "資料"

• [todo-001] プレゼン資料を作成する (pending)
• [todo-005] 仕様資料の更新 (completed)

2件見つかりました
```

### `!todo help` - TODOヘルプ
```bash
!todo help
```

**機能**: TODOコマンドのヘルプを表示

---

## 📊 サマリー・分析コマンド

### `!summary` - 今日のサマリー
```bash
!summary
```

**機能**: 今日の現在までの活動分析を表示

**レスポンス例:**
```
📊 今日の活動サマリー（2025-07-06）

⏰ 活動時間分析
• 作業時間: 4時間30分
• 会議時間: 1時間30分
• 休憩時間: 30分

📈 生産性スコア: 85/100

💡 インサイト
• 午前中の集中度が高めです
• 適度な休憩が取れています

🎯 改善提案
• 午後の作業効率を上げるため、短い休憩を増やしてみましょう
```

### `!summary <日付>` - 指定日のサマリー
```bash
!summary 2025-06-27
!summary yesterday
!summary -1
```

**パラメータ:**
- `日付`: YYYY-MM-DD形式、または相対指定（yesterday, -1など）

### `!summary refresh` - 強制再分析
```bash
!summary refresh
```

**機能**: キャッシュを無視して再分析を実行

### `!summary integrated` - 統合サマリー（TODO含む）
```bash
!summary integrated
```

**機能**: 活動ログとTODOを統合した包括的なサマリーを表示

**レスポンス例:**
```
📊 統合サマリー（2025-07-06）

📝 TODO概要
• 完了率: 40% (2/5件)
• 進行中: 1件
• 高優先度タスク: 2件残り

⏰ 活動時間分析
• 作業時間: 4時間30分
• TODO関連作業: 2時間15分 (50%)

🔗 相関分析
• 「プレゼン資料作成」TODO → 1時間45分の作業ログと関連
• 効率的にタスクを進行中

⭐ 生産性スコア: 87/100

💡 パーソナライズド推奨
• TODO完了のペースが適切です
• 午後の集中時間にプレゼン資料を完成させることをお勧めします
```


### `!summary todo <日付>` - 特定日のTODO統合サマリー
```bash
!summary todo 2025-06-27
```

**パラメータ:**
- `日付`: YYYY-MM-DD形式

---

## 🌍 タイムゾーン設定コマンド

### `!timezone` - 現在設定表示
```bash
!timezone
```

**レスポンス例:**
```
🌍 タイムゾーン設定

現在の設定: Asia/Tokyo (JST, UTC+9)
現在時刻: 2025-07-06 15:30:00 JST

設定変更: !timezone set <タイムゾーン>
検索: !timezone search <キーワード>
```

### `!timezone set <タイムゾーン>` - タイムゾーン設定
```bash
!timezone set Asia/Tokyo
!timezone set America/New_York
!timezone set Europe/London
```

**パラメータ:**
- `タイムゾーン` (必須): IANA タイムゾーン名

**レスポンス:**
- ✅ 成功: "タイムゾーンをAsia/Tokyoに設定しました"
- ❌ 失敗: "無効なタイムゾーンです"

### `!timezone search <キーワード>` - タイムゾーン検索
```bash
!timezone search Tokyo
!timezone search New York
!timezone search London
```

**パラメータ:**
- `キーワード` (必須): 検索キーワード

**レスポンス例:**
```
🔍 タイムゾーン検索結果: "Tokyo"

1. Asia/Tokyo (日本標準時, UTC+9)
   現在時刻: 15:30

設定するには: !timezone set Asia/Tokyo
```

---

## 💰 コスト管理コマンド

### `!cost` - API使用量レポート
```bash
!cost
```

**機能**: Gemini API の使用量とコストレポートを表示

**レスポンス例:**
```
📊 API使用量レポート - 2025年07月06日

📈 本日の合計
• 呼び出し回数: 25回
• 入力トークン: 12,500
• 出力トークン: 5,800
• 推定費用: $0.2175

📋 操作別内訳
• 活動分析: 15回 ($0.1350)
• TODO分類: 8回 ($0.0625)
• サマリー生成: 2回 ($0.0200)

💡 コスト効率
• 1回あたり平均: $0.0087
• 今月累計: $2.45
• 予算残り: 85%

🎯 最適化提案
• キャッシュ利用率: 78%
• 効率的な使用を継続中
```

---

## 🤖 AI自動TODO検出機能

### 自動分類フロー

#### 1. メッセージ投稿
```
"プレゼン資料を作成する必要がある"
```

#### 2. AI分析結果表示
```
📋 AI分析結果

💭 このメッセージからTODOを検出しました
内容: "プレゼン資料を作成する"
信頼度: 85%

理由: TODO関連キーワード「必要がある」「作成する」が含まれています
```

**インタラクティブボタン:**
- ✅ TODOとして追加
- ❌ 無視する  
- 📝 メモとして保存

#### 3. ユーザー確認
ボタンクリックで最終的な分類を決定

---

## 📅 自動機能

### スケジュール機能

#### 定期問いかけ
- **頻度**: 平日9:00-18:00、毎時0分・30分
- **内容**: "現在の活動は何ですか？"
- **応答**: 自然言語で活動内容を返信

#### 日次サマリー自動送信
- **時刻**: 毎日 5:00 AM
- **内容**: 前日の完全なサマリー（統合分析）
- **形式**: 詳細な分析レポート

#### APIコストレポート自動送信
- **時刻**: 毎日 5:05 AM
- **内容**: 前日のAPI使用量とコストサマリー

---

## ⚠️ エラーレスポンス

### 共通エラー形式
```
❌ エラーメッセージ

詳細: [具体的なエラー内容]
解決方法: [推奨する対処法]
```

### エラータイプ

#### 1. コマンド構文エラー
```
❌ コマンドの構文が正しくありません

使用方法: !todo add <内容>
例: !todo add 資料を作成する
```

#### 2. リソース未発見エラー
```
❌ 指定されたTODOが見つかりません

ID: todo-123
確認: !todo で一覧を表示してください
```

#### 3. 権限エラー
```
❌ 他のユーザーのTODOは操作できません

ヒント: 自分のTODOのみ操作可能です
```

#### 4. システムエラー
```
❌ システムエラーが発生しました

状況: データベース接続エラー
対処: しばらく待ってから再試行してください
```

---

## 🔧 開発者向け技術情報

### レスポンス形式

#### 成功レスポンス
- **文字列**: 単純なメッセージ
- **Embed**: 構造化された情報表示
- **ButtonInteraction**: インタラクティブUI

#### TODO分類結果Embed構造
```typescript
{
  title: "📋 AI分析結果",
  description: "分類結果の詳細",
  color: 0x00ff00,  // 緑色
  fields: [
    {
      name: "検出内容",
      value: "プレゼン資料を作成する",
      inline: false
    },
    {
      name: "信頼度",
      value: "85%",
      inline: true
    }
  ],
  timestamp: new Date().toISOString()
}
```

#### インタラクティブボタン
```typescript
{
  type: ComponentType.ActionRow,
  components: [
    {
      type: ComponentType.Button,
      style: ButtonStyle.Success,
      label: "✅ TODOとして追加",
      customId: `confirm_TODO_${sessionId}`
    },
    {
      type: ComponentType.Button,
      style: ButtonStyle.Secondary,
      label: "❌ 無視する",
      customId: `ignore_TODO_${sessionId}`
    }
  ]
}
```

### パフォーマンス最適化

#### キャッシュ戦略
- **分析結果**: 24時間キャッシュ
- **無効化**: ログ更新時に自動無効化
- **強制更新**: `refresh`パラメータで可能

#### 並行処理
- **活動記録 + TODO分類**: 並行実行（30-40%性能向上）
- **API制限**: バッチサイズ3でレート制限対応

---

**📚 本コマンドリファレンスは、Discord TimeLogger with TODO Management v2.0 の完全な仕様書です。**